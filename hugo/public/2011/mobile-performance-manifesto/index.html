<!DOCTYPE html>
<html lang="en-US">
    <head>
         
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Mobile Performance Manifesto</title>
        
        <style>

    html body {
        font-family: 'Roboto', sans-serif;
        background-color: white;
    }

    :root {
        --accent: #0D47A1;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="https://davidbcalhoun.com/css/main.css">





<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">


 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/foundation.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
 


    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

     <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/kotlin.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scala.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/swift.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js"></script> 

    <script>hljs.initHighlightingOnLoad();</script>







<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>
 <meta name="generator" content="Hugo 0.42.2" />
        

        
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-5530615-3"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments)};
          gtag('js', new Date());

          gtag('config', 'UA-5530615-3');
        </script>
        

        <meta name="author" content="David Calhoun">
        <link href="/index.xml" rel="alternate" type="application/rss+xml" title="David Calhoun&#39;s blog" />
        <link href="/index.xml" rel="feed" type="application/rss+xml" title="David Calhoun&#39;s blog" />

    </head>

    
    
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    

    <body>
         
        <nav class="navbar navbar-default navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">

                    <a class="navbar-brand visible-xs" href="#">Mobile Performance Manifesto</a>

                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse">

                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="https://www.themaingate.net/">Home</a></li>
                            
                                <li><a href="/">Posts</a></li>
                            
                        </ul>
                    

                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="mailto:david.b.calhoun@gmail.com"><i class="fa fa-envelope-o"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://github.com/davidcalhoun/"><i class="fa fa-github"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://twitter.com/franksvalli/"><i class="fa fa-twitter"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.linkedin.com/in/davidcalhoun/"><i class="fa fa-linkedin"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://stackoverflow.com/users/214017/david-calhoun/"><i class="fa fa-stack-overflow"></i></a></li>
                            
                        </ul>
                    

                </div>

            </div>

        </nav>


<main role="main" itemscope itemType="http://schema.org/BlogPosting">
    <meta itemprop="inLanguage" content="en-US" />
    <span itemscope itemprop="author" itemType="https://schema.org/Person">
        <meta itemprop="name" content="David Calhoun" />
    </span>
    <span itemscope itemprop="publisher" itemType="https://schema.org/Organization">
        <meta itemprop="name" content="David Calhoun" />
        <meta itemprop="url" content="https://themaingate.net" />
        <meta itemprop="logo" content="https://themaingate.net/david-calhoun-logo.png">
    </span>
    <meta itemprop="image" content="https://themaingate.net/david-calhoun-logo.png">

    <article class="item">

    
    
    

    
    

    <meta property="article:section" content="Article" />
    <meta property="article:publisher" content="https://www.davidbcalhoun.com" />
    <meta property="article:published_time" content="October 11, 2011" />
    <meta property="article:modified_time" content="October 11, 2011" />
    <meta property="article:tag" content="webdev" />
    <meta property="article:tag" content="mobile" />
    <meta property="article:tag" content="performance" />
    
    <meta property="og:site_name" content="CSS-Tricks" />
    <meta property="og:updated_time" content="October 11, 2011" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="/2011/mobile-performance-manifesto/" />
    <meta property="og:title" content="Mobile Performance Manifesto" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Mobile Performance Manifesto" />
    <meta name="twitter:site" content="@franksvalli" />
    <meta name="twitter:creator" content="@franksvalli" />
    <meta name="twitter:domain" content="davidbcalhoun.com" />


    <h4 itemprop="headline">
        <a href="/2011/mobile-performance-manifesto/" itemprop="url">Mobile Performance Manifesto</a>
    </h4>
    <h5 class="meta date" itemprop="datePublished dateModified" content="October 11, 2011" datetime="October 11, 2011">
        <time>October 11, 2011</time>
    </h5>
    
    <a href="https://davidbcalhoun.com/tags/webdev"><kbd class="item-tag">webdev</kbd></a>
    
    <a href="https://davidbcalhoun.com/tags/mobile"><kbd class="item-tag">mobile</kbd></a>
    
    <a href="https://davidbcalhoun.com/tags/performance"><kbd class="item-tag">performance</kbd></a>
    

</article>


    <br> <div class="text-justify">

<p><img src="http://davidbcalhoun.com/wp-content/uploads/2011/10/odometer.jpg" alt="" title="Dashboard with odometer" width="800" height="299" class="aligncenter size-full wp-image-806" /></p>

<p>Earlier this year I gave a <a href="http://www.meetup.com/SF-Web-Performance-Group/events/16116764">talk</a> (<a href="http://davidbcalhoun.com/present/mobile-performance/">slides</a>) outlining the latest and greatest in mobile performance, including a bit of my own unscientific research into carrier latency and bandwidth thanks to <a href="https://github.com/yahoo/boomerang">boomerang.js</a>.</p>

<p>I realized that interest in mobile performance has exploded recently, especially with <a href="http://www.stevesouders.com/blog/2011/01/10/announcing-my-focus-on-mobile/">Steve Souders announcing his focus on mobile</a>, and I thought it was time for an update, this time in blog form. Also, my old <a href="http://davidbcalhoun.com/present/mobile-performance/">slides</a> have been somewhat embarrassing. For some strange reason, at the time I wanted to give <a href="http://meyerweb.com/eric/tools/s5/">S5</a> a try - that outdated, ancient, not-performant slideshow framework. The result is a slideshow on performance that loads slowly&hellip; doh! (incidentally, I recommend <a href="http://imakewebthings.github.com/deck.js/">deck.js</a> as an alternative).</p>

<p>In any case, it was time for a roundup of mobile performance best practices, in blog form. I&rsquo;m not sure if it&rsquo;s properly called a manifesto, but it is what it is! Onward!</p>

<h3 id="for-fun-latency-and-bandwidth-tests">For fun: Latency and bandwidth tests</h3>

<p>Before we start.. just a little fun data! It&rsquo;s always been a pleasure to fiddle around with <a href="https://github.com/yahoo/boomerang">boomerang.js</a> and compare results. With my latest trip to Japan, I had the opportunity to run Boomerang on Japan&rsquo;s <a href="http://en.wikipedia.org/wiki/EMOBILE_Limited">e-mobile</a> 3G network in the remotest of places, up in Hakuba/Nagano in the Japanese alps.</p>

<p>When I got back, I ran the same tests from downtown San Francisco, which was closer to my California-based test server, and should&rsquo;ve been faster, right? Theoretically&hellip;</p>

<h4 id="boomerang-tests-running-on-a-california-hosted-server">Boomerang Tests (running on a California-hosted server)</h4>

<table style="width: 100%;">
  <th>
    <td>
      Verizon 3G (SF)
    </td>
    
    <td>
      ATT 3G (SF)
    </td>
    
    <td>
      e-mobile 3G (Hakuba)
    </td>
  </th>
  
  <tr>
    <td>
      Latency
    </td>
    
    <td class="positive">
      251ms
    </td>
    
    <td>
      901ms
    </td>
    
    <td>
      401ms
    </td>
  </tr>
  
  <tr>
    <td>
      Bandwidth
    </td>
    
    <td>
      62kbps
    </td>
    
    <td>
      3kbps
    </td>
    
    <td class="positive">
      95kbps
    </td>
  </tr>
</table>

<p>Yes, e-mobile didn&rsquo;t have the greatest ping, but it handily beat ATT, even though it was going across the entire Pacific Ocean! Note that it came out the best in the bandwidth tests however&hellip;</p>

<p>(Note: it&rsquo;s unknown if or how <a href="http://stevesouders.com/ms/">Steve Souders&rsquo;s latest research</a> affects these findings)</p>

<p>There&rsquo;s a lot of factors that could&rsquo;ve been involved, so look to something like <a href="http://opensignalmaps.com/">OpenSignalMaps</a> for more data.</p>

<p>Ok, onto the tips!</p>

<h3 id="page-organization">Page Organization</h3>

<p><img src="http://davidbcalhoun.com/wp-content/uploads/2011/10/mobile-site-organization.png" alt="" title="Smart phone versus feature phone website organization" width="645" height="633" class="aligncenter size-full wp-image-793" /></p>

<p>For feature phones that have little to no caching, aggressively combine requests (deliver HTML/CSS/JS all in one package). For smart phones, take advantage of caching by mirroring desktop frontend best practices: separate HTML, CSS, and JS so they can be cached (per-session and across sessions).</p>

<p>There&rsquo;s old research about <a href="http://www.yuiblog.com/blog/2008/02/06/iphone-cacheability/">extremely small cache sizes on iOS in particular</a>, but this research has been followed up on by more recent research by <a href="http://www.yuiblog.com/blog/2010/07/12/mobile-browser-cache-limits-revisited/">Ryan Grove (Yahoo!)</a> and <a href="http://www.stevesouders.com/blog/2010/07/12/mobile-cache-file-sizes/">Steve Souders (Google)</a>, which shows that we shouldn&rsquo;t be so paranoid, since caching is pretty decent across all the major mobile browsers.</p>

<p>Of particular interest is a browser&rsquo;s capability to cache files in a current session, browsing from page-to-page, which is what most users will end up doing (caching of the page across sessions is another matter). What is the maximum file size a browser will cache during a session? The <a href="http://www.browserscope.org/user/tests/table/agt1YS1wcm9maWxlcnINCxIEVGVzdBj_1OsBDA?v=3&amp;#038;layout=simple&amp;#038;f=Max%20js%20Cache%20Size%20(kB)">results (via Browserscope)</a> end up being encouraging:</p>

<table style="width: 100%;">
  <th>
    <td>
      Maximum Cache Size (MB)
    </td>
  </th>
  
  <tr>
    <td>
      Android 2.1
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      Android 2.2
    </td>
    
    <td>
      2
    </td>
  </tr>
  
  <tr>
    <td>
      Android 2.3
    </td>
    
    <td>
      2
    </td>
  </tr>
  
  <tr>
    <td>
      Android 3.0
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      Blackberry 6.0.0
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      iPad 4.3.5
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      iPad 5.0
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      iPhone 4.3.5
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      iPhone 5.0
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      Opera Mini 4
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      Opera Mini 5
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      Opera Mini 6
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      webOS 2.0
    </td>
    
    <td>
      1
    </td>
  </tr>
</table>

<h3 id="avoid-redirects-foo-com-m-foo-com">Avoid redirects (foo.com -&gt; m.foo.com)</h3>

<p>If possible, perform the redirection behind the scenes on the server, which should be transparent to the user. When a user performs a Google search and clicks on your page, they&rsquo;re already getting redirected once by Google (check it yourself). Your own redirects are adding a second redirect where there need not be one.</p>

<h3 id="optimize-images">Optimize Images</h3>

<p><a href="http://filamentgroup.com/examples/responsive-images-new/demos/A-Default/demo.html"><img src="http://davidbcalhoun.com/wp-content/uploads/2011/10/responsive-images.jpg" alt="" title="Responsive images" width="600" height="423" class="aligncenter size-full wp-image-796" /></a><br />
Deliver appropriately-sized images to devices. The philosophy of responsive design makes it easy to simply downscale images to fit the screen, but avoid this where possible, as this means wasted bandwidth.</p>

<p>You can optimize images through CSS media queries or in JavaScript (see below). Though you want to reduce your dependence on cookies, it may be a good idea to store these width/height values into a cookie (or localStorage if you are fetching images in nontraditional ways) so the values can be read by the server, which can deliver appropriately-sized images. This technique has been <a href="http://filamentgroup.com/lab/responsive_images_experimenting_with_context_aware_image_sizing/">implemented by Filament Group</a>, so you should probably read about their experiences before trying to roll your own.</p>

<p>Also note that where applicable, at the expense of performance you may want to serve higher resolution images for better screens, such as for Retina displays (which can be detected with JavaScript or CSS).</p>

<h4 id="javascript-examples">JavaScript examples</h4>

<pre><code class="language-js">window.innerHeight;       // max height actually available
window.innerWidth;        // max width actually available
window.devicePixelRatio;  // pixel density (standard is 1, high resolution is generally &gt; 1)
</code></pre>

<p>(note that <code>screen.width</code> and <code>screen.height</code> are also available to tell you the dimensions of the entire screen, but this isn&rsquo;t all available due to the space taken by the OS and browser chrome)</p>

<h4 id="media-query-examples">Media query examples</h4>

<pre><code class="language-css">@media only screen and (max-width: 480px) {
  /* small screen styles */
}

@media only screen and (min-width: 481px) {
  /* large screen styles */
}

@media (-webkit-min-device-pixel-ratio: 1.5),
       (-o-min-device-pixel-ratio: 3/2),
       (min--moz-device-pixel-ratio: 1.5),
       (min-device-pixel-ratio: 1.5) {
  /* high resolution styles */
}
</code></pre>

<h3 id="navigator-connection-android-only">navigator.connection (Android only)</h3>

<p>Use <a href="http://davidbcalhoun.com/2010/using-navigator-connection-android">navigator.connection</a> if it&rsquo;s available to serve different assets based on connection speed (3G vs WIFI, for instance).</p>

<p>Here&rsquo;s the contents of the <code>navigator.connection</code> object (with a phone running on a 3G connection):</p>

<pre><code class="language-js">{
  type: 4,
  UNKNOWN: 0,
  ETHERNET: 1,
  WIFI: 2,
  CELL_2G: 3,
  CELL_3G: 4
}
</code></pre>

<p>And an example of how you could write code for each type:</p>

<pre><code class="language-js">(function(){  // sandbox our code
  if(!navigator.connection) navigator.connection = {type:0, UNKNOWN: 0};  // polyfill
  var connection = navigator.connection;
  
  if(connection.type === connection.WIFI || connection.type === connection.ETHERNET) {
    // high bandwidth
  } else {
    // normal bandwidth
  }
})();
</code></pre>

<p>Here&rsquo;s how we might be able to use <a href="http://modernizr.com/">Modernizr</a> to help us out:</p>

<pre><code class="language-js">(function(){  // sandbox our code
  if(!navigator.connection) navigator.connection = {type:0, UNKNOWN: 0};  // polyfill
  var connection = navigator.connection;
  
  // add a custom test to Modernizr
  Modernizr.addTest('highbandwidth', function(){
    return connection.type === connection.WIFI || connection.type === connection.ETHERNET;
  });

})();
</code></pre>

<p>We can now target special high-bandwidth assets with CSS:</p>

<pre><code class="language-css">.highbandwidth .logo {background-image:url('logo-high.jpg');}
.no-highbandwidth .logo {background-image:url('logo.jpg');}
</code></pre>

<h3 id="base64-encode-small-ui-images">base64 encode small UI images</h3>

<p>You can base64 encode binary image data in HTML and CSS:</p>

<h4 id="html">HTML</h4>

<pre><code class="language-html">&lt;img src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA
AAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO
9TXL0Y4OHwAAAABJRU5ErkJggg==&quot; alt=&quot;Red dot&quot;&gt;
</code></pre>

<h4 id="css">CSS</h4>

<pre><code class="language-css">.dot {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA  
AAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO  
9TXL0Y4OHwAAAABJRU5ErkJggg==');
}
</code></pre>

<p>There seems to be the mistaken belief floating around that base64 images aren&rsquo;t cacheable. However, because you can embed them in your CSS, base64 encoded images will be cached along with the rest of your CSS.</p>

<p>You&rsquo;ll probably just want to limit this to small UI icons however. I wrote a <a href="http://davidbcalhoun.com/2011/when-to-base64-encode-images-and-when-not-to">quick post on the drawbacks, and also a comparison with sprites</a>.</p>

<p>If you&rsquo;re using Compass/SASS, base64 encoding images is pretty trivial and easy to maintain with the <a href="http://compass-style.org/reference/compass/helpers/inline-data/">inline-image helper</a>.</p>

<h3 id="unicode-and-emoji">Unicode and Emoji</h3>

<p>&#9734; (HTML entity: #9734)<br />
<img src="http://davidbcalhoun.com/wp-content/uploads/2011/10/emoji3.png" alt="" title="Emoji" width="18" height="18" /> (HTML entity: <code>#x1f468</code>)</p>

<p>Before even considering base64 images, take advantage of icons that are already made for you: unicode characters and <a href="http://pukupi.com/post/1964">emoji</a> (where supported). Keep in mind that these will look different across browsers, so this might not be an option for everyone.</p>

<p>Because of inconsistent implementations of Emoji character codes between Asian carriers, representatives from Apple and Google made a <a href="http://en.wikipedia.org/wiki/Emoji#Emoji_in_the_Unicode_standard">proposal to add Emoji to the Unicode standard</a>. Unfortunately it seems that only iPhone supports them for now. Here&rsquo;s a <a href="http://www.unicode.org/charts/PDF/U1F300.pdf">handy chart of all the Unicode emoji characters available</a>.</p>

<h3 id="take-advantage-of-css3">Take advantage of CSS3</h3>

<p>CSS3 offers many replacements for things we needed images for previously. RGBA values replace the need for a semitransparent image for overlays and such. Likewise, border-radius, box shadow, linear-gradients, radial-gradients all reduce the need for images.</p>

<p>However, do be aware that though phones support these new features, it doesn&rsquo;t mean they&rsquo;re necessarily ready for primetime. Something I&rsquo;ve encountered recently to remind me of this fact is <a href="http://code.google.com/p/android/issues/detail?id=767">severe color banding issues when using a CSS radial gradient</a>. The solution was to fake the radial gradient using two linear gradients, or to (unfortunately) use an old-fashioned image.</p>

<h3 id="avoid-using-cookies">Avoid using cookies</h3>

<p>Cookies get thrown into <em>every</em> request on a per-domain basis, so limit your usage of them. Use localStorage/sessionStorage instead, where possible.</p>

<h3 id="app-cache">App cache</h3>

<p>Take advantage of the HTML5 app cache, though it&rsquo;s an unwieldy beast to tame. This will mean you will need to make your site work offline, which might be tricky.</p>

<p>Assets that are traditionally cached get rechecked on page refresh (the server sends back a 304 response if your cache is still up-to-date). Whereas with the app cache, only one file (your manifest) is rechecked on page load.</p>

<h3 id="deferred-javascript-execution">Deferred JavaScript execution</h3>

<p><img src="http://davidbcalhoun.com/wp-content/uploads/2011/10/gmail-deferred-javascript-execution.png" alt="" title="Gmail deferred JavaScript execution" width="497" height="450" class="aligncenter size-full wp-image-810" /></p>

<p>We know that deferring downloading of scripts is advantageous (by placing scripts at the bottom of a page or by using the <code>async</code> attribute), but deferred execution of JavaScript is even more important. Sure, we can use the <code>defer</code> attribute, but that&rsquo;s only really relevant for when the page is loading (<code>defer</code> lets the browser know that the UI doesn&rsquo;t depend on the JavaScript, so it can be safely deferred).</p>

<p>But what about JavaScript that runs after the page loads, such as XHR and JSONP requests? What does this mean for the user? It means that the UI freezes up unexpectedly when JavaScript is being downloaded and executed in the background. But this doesn&rsquo;t mean that you want to completely avoid background downloading of JavaScript. The Gmail mobile team came up with a <a href="http://googlecode.blogspot.com/2009/09/gmail-for-mobile-html5-series-reducing.html">clever solution</a>: by commenting all of their code and dynamically eval&rsquo;ing it when needed, they split up the JavaScript downloading from its execution.</p>

<h3 id="perceived-performance">Perceived performance</h3>

<p>Do whatever you have to do to let the user know that the UI is still responding. This sometimes means faking that something is happening. Communication is key! If they clicked on a button, give some indication that they clicked on it. If they clicked on something that requires a request to the network, show a spinner right away, even if it means you haven&rsquo;t even sent out a request. The user doesn&rsquo;t need to know the nitty-gritty details - they just want to know that their intent was communicated.</p>

<h3 id="onclick-delay">Onclick delay</h3>

<p>On several major mobile operating systems there&rsquo;s a several hundred millisecond delay on the onclick event. This is because of the double-tap-to-zoom functionality. When a user first taps on the screen, there&rsquo;s a hard-coded delay that waits for the second tap. If there&rsquo;s no second tap, the onclick event is then fired. Unfortunately the only way to get around the delay is to tap into touch events instead, which is a bit more complicated than it appears on first glance.</p>

<p>For an overview of some of the challenges of implementing the workaround, see <a href="http://code.google.com/mobile/articles/fast_buttons.html">this article by Google&rsquo;s Ryan Fioravanti</a>.</p>

<h3 id="take-advantage-of-hardware-acceleration">Take advantage of hardware acceleration</h3>

<p>Use hardware-accelerated CSS transforms where possible (translate3d, translateZ, rotate3d, and scale3d). An element that is hardware accelerated is turned into a graphic, which is perfect for the GPU to manipulate, taking away the burden from the CPU.</p>

<p>However, the GPU isn&rsquo;t all-powerful, so don&rsquo;t try to apply hardware accelerations to everything. Also, these elements still need to be refreshed periodically, and it turns out that you can make some good optimizations here. First, you&rsquo;ll want to debug the composited layers on your desktop browser:</p>

<h4 id="debugging-hardware-acceleration">Debugging hardware acceleration</h4>

<p><a href="http://www.webkit.org/blog-files/3d-transforms/poster-circle.html"><img src="http://davidbcalhoun.com/wp-content/uploads/2011/10/debug-composited-layers-hardware-acceleration.png" alt="" title="WebKit's poster circle demo with and without the debug information" width="767" height="399" class="aligncenter size-full wp-image-803" /></a><br />
<em>Chrome</em></p>

<ol>
<li>Type the following in the address bar: about:flags</li>
<li>&ldquo;Composited render layer borders&rdquo; -&gt; Enable</li>
</ol>

<p><em>Safari</em></p>

<ol>
<li>Open a terminal</li>
<li>$ defaults write com.apple.Safari IncludeInternalDebugMenu 1</li>
<li>$ defaults write com.apple.Safari CA_COLOR_OPAQUE 1</li>
<li>Open (or restart) Safari</li>
<li>Debug -&gt; Show Compositing Borders</li>
</ol>

<p>(to turn these off, run the same commands with a boolean FALSE: i.e. <code>defaults write com.apple.Safari CA_COLOR_OPAQUE FALSE</code>)</p>

<p>Keep in mind that each composited layer has a limited width and height. For instance, if you&rsquo;re creating an image carousel, chances are the dimensions of the element will be too big to fit the layer into memory as one piece. This means that when the element is animated, the GPU has to break up the layer manually into several manageable chunks. It&rsquo;s much better to chunk it yourself. To do this, you trigger hardware acceleration on each chunk.</p>

<p>So you will change this:</p>

<pre><code class="language-css">.carousel {
  -webkit-transform: translate3d(0,0,0);  /* or translateZ(0); */
}
</code></pre>

<p>To this:</p>

<pre><code class="language-css">.carousel {
  -webkit-transform: translate3d(0,0,0);  /* or translateZ(0); */
}

.carousel-pane {
  -webkit-transform: translate3d(0,0,0);  /* or translateZ(0); */
}
</code></pre>

<p>Where carousel-pane represents each child element of the carousel.</p>

<p>More info: <a href="http://dl.dropbox.com/u/5618867/mseeley-2011-09-27-html5devconf.pdf">(slides) WebKit in Your Living Room (Matt Seeley, Netflix)</a></p>

<p>Also see <a href="http://www.html5rocks.com/en/mobile/optimization-and-performance.html">HTML5 Techniques for Optimizing Mobile Performance</a>.</p>

<h3 id="http-pipelining">HTTP Pipelining</h3>

<p><a href="http://www.blaze.io/mobile/http-pipelining-big-in-mobile/"><img src="http://davidbcalhoun.com/wp-content/uploads/2011/10/pipelining.png" alt="HTTP Pipelining diagram" title="HTTP Pipelining (via Blaze.io)" width="640" height="445" class="aligncenter size-full wp-image-783" /></a></p>

<p>Take advantage of <a href="http://www.blaze.io/mobile/http-pipelining-big-in-mobile/">HTTP Pipelining</a>, which is often overlooked, but has broad support on mobile. This virtually eliminates round trip times, for all but the first request.</p>

<p>Opera and Android support pipelining, and the newly released iOS 5 has added support for it.</p>

<p>Great! So how do you make sure your server is taking advantage of pipelining?</p>

<blockquote>
<p>The first request to every server is sent by itself (only one request on the connection), and the browser looks for two properties in the response:</p>

<ol>
<li>Use of HTTP/1.1</li>
<li>An explicit “Connection: Keep-Alive” header (required by Android)</li>
</ol>

<p><a href="http://www.blaze.io/mobile/http-pipelining-big-in-mobile/">-Blaze.io</a></p>
</blockquote>

<p>If these criteria are met, subsequent requests will be pipelined. Sweet!</p>

<h3 id="dns-prefetching">DNS Prefetching</h3>

<p>Take advantage of <a href="https://developer.mozilla.org/En/Controlling_DNS_prefetching">DNS Prefetching</a>. This theoretically speeds up load times, but there have been <a href="http://www.mydigitallife.info/turn-off-dns-prefetching-in-google-chrome-to-fix-resolving-host-and-cannot-load-page-error/">some issues</a>, so be sure to test it.</p>

<p>To turn off DNS Prefetching, serve this meta tag:</p>

<pre><code class="language-html">&lt;meta http-equiv=&quot;x-dns-prefetch-control&quot; content=&quot;off&quot;&gt;
</code></pre>

<p>You can also explicitly force a DNS lookup:</p>

<pre><code class="language-html">&lt;link rel=&quot;dns-prefetch&quot; href=&quot;http://www.example.com/&quot;&gt;
</code></pre>

<h3 id="avoid-library-code-bloat">Avoid library code bloat</h3>

<p>If you&rsquo;re developing for smart phones, you may be able to dramatically reduce the data over the wire by simply using new JavaScript APIs instead of a full-blown library or framework such as jQuery Mobile (which is rather a UI framework and depends on the desktop version of jQuery).</p>

<p>Among the things offered by newer browsers, which should reduce your dependence on a library:</p>

<ul>
<li><a href="https://developer.mozilla.org/En/DOM/Document.querySelector">querySelector</a>/<a href="https://developer.mozilla.org/en/DOM/document.querySelectorAll">querySelectorAll</a>: CSS selectors that replace the need for a selector engine</li>
<li><a href="https://developer.mozilla.org/en/DOM/document.getElementsByClassName">getElementsByClassName</a></li>
<li><a href="https://developer.mozilla.org/en/DOM/element.classList">classList</a> - replaces the need for hasClass, addClass, removeClass helpers (available on iOS5, but not sure what else)</li>
<li><a href="https://developer.mozilla.org/En/XMLHttpRequest/Using_XMLHttpRequest">XMLHttpRequest</a> - it&rsquo;s probably time to learn how to do this natively instead of using a wrapper that takes care of IE&rsquo;s old implementation that requests an ActiveX object. <a href="http://hacks.mozilla.org/2009/07/cross-site-xmlhttprequest-with-cors/">Cross-Origin Resource Sharing</a> also means we can easily share resources across domains.</li>
<li><a href="https://developer.mozilla.org/en/DOM/Manipulating_the_browser_history">HTML5 history (pushState, etc)</a> - though an <a href="https://bugs.webkit.org/show_bug.cgi?id=42940">older bug</a> means you should maybe hold off for now (note: the fix is present in iOS 5, which is based on a newer WebKit)</li>
<li><a href="http://www.the-art-of-web.com/html/html5-form-validation/">HTML5 Form Validation</a> reduces our need for JavaScript-based validation</li>
<li>HTML5 input types that reduce our need for custom UI controls (date, time, slider [range], etc)</li>
</ul>

<p>You&rsquo;ll want to consider using either a library that was optimized for the browsers you&rsquo;re targeting (such as <a href="http://zeptojs.com/">Zepto.js</a>) or simply bring in <a href="http://microjs.com/">a microlibrary for specific tasks you want to perform</a>.</p>

<h3 id="clientside-databases">Clientside databases</h3>

<p>Most mobile browsers currently support WebSQL, which is being phased out in support of indexedDB, which is not widely implemented. However, if you use a wrapper such as <a href="http://westcoastlogic.com/lawnchair/">Lawnchair</a>, the transition from one to the other is relatively painless.</p>

<h3 id="todo-testing">TODO: testing</h3>

<h3 id="more">More</h3>

<p>(to be expanded on later)</p>

<ul>
<li>use standard desktop best practices (for smart phones)</li>
<li>requestAnimationFrame instead of setTimeout</li>
<li>setImmediate (where available) instead of setTimeout(fn(){},0)</li>
<li>Ajax parsing times: you might want to use Multipart XHR so you can yield the process as it&rsquo;s going through big responses (to prevent the UI locking up)</li>
<li>avoid rgba, box shadows, text shadow, etc, as this greatly degrades performance (especially on animations)</li>
<li>high resolution screens may suffer from animation/transition slowness - it&rsquo;s been shown that manipulating the viewport tag to scale the page <a href="http://29a.ch/2011/5/27/fast-html5-canvas-on-iphone-mobile-safari-performance">will speed up canvas rendering</a>, and <a href="http://paulbakaus.com/2011/10/10/scroller-vs-scrollability-deathmatch/">high-dpi scaling concerns are also evident in CSS transforms</a></li>
<li><a href="http://joehewitt.com/2011/10/05/fast-animation-with-ios-webkit">WebKit animations are faster than animations done via JavaScript</a></li>
<li>if you do use JavaScript-based animations, limit the UI updates to ~17ms, which is equivalent to 60fps, which is the fastest your display will refresh anyway, so it&rsquo;s pointless to try to do anything faster than that. Keep track of the time since the last UI update and don&rsquo;t do anything if 17ms haven&rsquo;t passed.</li>
</ul>

<h3 id="on-the-horizon">On the horizon&hellip;</h3>

<ul>
<li><a href="http://www.chromium.org/spdy">SPDY</a>: already implemented in Amazon&rsquo;s Silk browser for Kindle. Will possibly be on Android phones <a href="http://androidandme.com/2011/10/news/google-chrome-is-finally-coming-to-an-android-device-near-you/">when the browser is powered by Chrome</a></li>
<li>indexedDB replacing WebSQL</li>
</ul>

<h3 id="tools">Tools</h3>

<p><a href="http://stevesouders.com/mobileperf/mobileperfbkm.php">Mobile Perf bookmarklet</a><br />
<a href="http://calendar.perfplanet.com/2010/mobile-performance-analysis-using-pcapperf/">pcapperf (Packet Capture Web Performance Analyzer)</a><br />
<a href="http://www.blaze.io/mobile/">Blaze Mobitest</a> - tests the loading time of your site on actual phones</p>

<h3 id="more-resources">More Resources</h3>

<p><a href="http://www.w3.org/TR/mwabp/">Mobile Web Application Best Practices</a><br />
<a href="http://stevesouders.com/mobileperf/">Mobile Performance (Steve Souders)</a><br />
<a href="http://www.strangeloopnetworks.com/web-performance-optimization-hub/topics/mobile/">Strangeloop Web Performance Hub / Mobile</a></p>

<p>(odometer image via <a href="http://www.flickr.com/photos/henrybloomfield/4442900025/">henrybloomfield on Flickr</a>)</p>
</div>

    
    

    

    

        <h4 class="page-header">Comments</h4>

        <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "davidbcalhoun" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    

</main>

        <footer role="contentinfo">

            <p class="copyright text-muted">© <span itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="David Calhoun"><a href="mailto:david.b.calhoun@gmail.com" itemprop="email">David Calhoun</a> (<a href="https://twitter.com/franksvalli" itemprop="url">@franksvalli</a>) - <a href="https://www.linkedin.com/in/davidcalhoun" itemprop="url">LinkedIn</a> - <a href="http://themaingate.net/resume/" itemprop="url">Resume</a></span></p>

        </footer>
       
    </body>

</html>

