<!DOCTYPE html>
<html lang="en-US">
    <head>
         
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Is a hash faster than a Switch in JavaScript? - David Calhoun</title>
        
        <style>

    html body {
        font-family: 'Roboto', sans-serif;
        background-color: white;
    }

    :root {
        --accent: #0D47A1;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="https://davidbcalhoun.com/css/main.css">





<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">


 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/foundation.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
 


    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

     <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/kotlin.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scala.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/swift.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js"></script> 

    <script>hljs.initHighlightingOnLoad();</script>







<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>
 <meta name="generator" content="Hugo 0.42.2" />
        

        
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-5530615-3"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments)};
          gtag('js', new Date());

          gtag('config', 'UA-5530615-3');
        </script>
        

        <meta name="author" content="David Calhoun">
        <link href="/index.xml" rel="alternate" type="application/rss+xml" title="David Calhoun&#39;s blog" />
        <link href="/index.xml" rel="feed" type="application/rss+xml" title="David Calhoun&#39;s blog" />

    </head>

    
    
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    

    <body>
         
        <nav class="navbar navbar-default navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">

                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse">

                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="https://www.themaingate.net/">Home</a></li>
                            
                                <li><a href="/">Posts</a></li>
                            
                        </ul>
                    

                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="mailto:david.b.calhoun@gmail.com"><i class="fa fa-envelope-o"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://github.com/davidcalhoun/"><i class="fa fa-github"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://twitter.com/franksvalli/"><i class="fa fa-twitter"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.linkedin.com/in/davidcalhoun/"><i class="fa fa-linkedin"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://stackoverflow.com/users/214017/david-calhoun/"><i class="fa fa-stack-overflow"></i></a></li>
                            
                        </ul>
                    

                </div>

            </div>

        </nav>


<main role="main" itemscope itemType="http://schema.org/BlogPosting">
    <meta itemprop="inLanguage" content="en-US" />
    <span itemscope itemprop="author" itemType="https://schema.org/Person">
        <meta itemprop="name" content="David Calhoun" />
    </span>
    <span itemscope itemprop="publisher" itemType="https://schema.org/Organization">
        <meta itemprop="name" content="David Calhoun" />
        <meta itemprop="url" content="https://themaingate.net" />
        <meta itemprop="logo" content="https://themaingate.net/david-calhoun-logo.png">
    </span>
    <meta itemprop="image" content="https://themaingate.net/david-calhoun-logo.png">

    <article class="item">

    
    
    

    
    

    <meta property="article:section" content="Article" />
    <meta property="article:publisher" content="https://www.davidbcalhoun.com" />
    <meta property="article:published_time" content="August 17, 2010" />
    <meta property="article:modified_time" content="August 17, 2010" />
    
    <meta property="article:tag" content="javascript" />
    <meta property="article:tag" content="performance" />
    <meta property="article:tag" content="webdev" />
    <meta property="article:tag" content="android" />
    <meta property="article:tag" content="hash" />
    <meta property="article:tag" content="jsperf" />
    <meta property="article:tag" content="mobile safari" />
    <meta property="article:tag" content="switch" />
    
    <meta property="og:locale" content="en">
    <meta property="og:site_name" content="David Calhoun's Blog" />
    <meta property="og:updated_time" content="August 17, 2010" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="/2010/is-a-hash-faster-than-a-switch-in-javascript/" />
    <meta property="og:title" content="Is a hash faster than a Switch in JavaScript?" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Is a hash faster than a Switch in JavaScript?" />
    <meta name="twitter:site" content="@franksvalli" />
    <meta name="twitter:creator" content="@franksvalli" />
    <meta name="twitter:domain" content="davidbcalhoun.com" />
    


    <h4 itemprop="headline">
        <a href="/2010/is-a-hash-faster-than-a-switch-in-javascript/" itemprop="url">Is a hash faster than a Switch in JavaScript?</a>
    </h4>
    <h5 class="meta date" itemprop="datePublished dateModified" content="August 17, 2010" datetime="August 17, 2010">
        <time>August 17, 2010</time>
    </h5>
    
    <a href="https://davidbcalhoun.com/tags/javascript"><kbd class="item-tag">javascript</kbd></a>
    
    <a href="https://davidbcalhoun.com/tags/performance"><kbd class="item-tag">performance</kbd></a>
    
    <a href="https://davidbcalhoun.com/tags/webdev"><kbd class="item-tag">webdev</kbd></a>
    
    <a href="https://davidbcalhoun.com/tags/android"><kbd class="item-tag">android</kbd></a>
    
    <a href="https://davidbcalhoun.com/tags/hash"><kbd class="item-tag">hash</kbd></a>
    
    <a href="https://davidbcalhoun.com/tags/jsperf"><kbd class="item-tag">jsperf</kbd></a>
    
    <a href="https://davidbcalhoun.com/tags/mobile-safari"><kbd class="item-tag">mobile safari</kbd></a>
    
    <a href="https://davidbcalhoun.com/tags/switch"><kbd class="item-tag">switch</kbd></a>
    

</article>


    <br> <div class="text-justify">

<p>I stumbled across this concept recently and I thought I&rsquo;d share it, because I don&rsquo;t generally see this pattern being used. More importantly, I also share test results that show that maybe it&rsquo;s not always a good idea to use this pattern&hellip;</p>

<h3 id="the-problem-with-switch-statements">The problem with Switch statements</h3>

<p>The basic switch statement in JavaScript looks something like this:</p>

<pre><code class="language-js">var foo = 'c';

switch(foo) {
  case 'a':
  break;

  case 'b':
  break;

  case 'c':
  break;

  default:
}
</code></pre>

<p>So what&rsquo;s wrong with this? The JS engine has to examine a bunch of unrelated cases until it finds the relevant one, executes the code, then breaks out of the switch because the job is done (this is why it&rsquo;s important to break!). In the above example we had to go through case A and case B until finally reaching case C. What&rsquo;s worse is that if it didn&rsquo;t match any of these cases, the JS engine has to jump through ALL of the cases before it reaches Default, the fall-through case.</p>

<p>Actually it&rsquo;s not so bad, as long as there are a limited number of cases. It&rsquo;s probably no big deal if you only have a few cases to jump through. The problem gets bigger as your number of cases increases (some of you may know this as <a href="http://en.wikipedia.org/wiki/Big_O_notation">O(n)</a>). What happens when there&rsquo;s 10 cases? Then there&rsquo;s potentially 10 checks on cases (assuming what ended up being executed was the default). 100 cases? Then potentially 100 checks.</p>

<p>What would be better is if there were a way to reduce the number of checks. One way would be to put the most frequently used cases at the top. This would alleviate some of the pain, but you still end up with extra processing while the JS checks each case. It would be ideal to avoid this extra processing altogether.</p>

<h3 id="an-alternative-the-hash-table">An alternative: The hash table</h3>

<p>There is a way to avoid this extra processing! It&rsquo;s by leading the code directly where it needs to go, without unnecessary checking of unrelated cases.</p>

<p>You can do this using a hash. In JavaScript we accomplish this with an object:</p>

<pre><code class="language-js">var foo = 'c';
var cases = {};
cases['a'] = function() {
  alert('I am A!');
};
cases['b'] = function() {
  alert('I am B!');
};
cases['c'] = function() {
  alert('I am C!');
}

if(typeof cases[foo] == 'function') {
  // only executes if we've defined it above
  cases[foo]();  // I am C!
} else {
  // default (the fallthrough)
}
</code></pre>

<p>There we go! No extra case checking here. We&rsquo;ve led the JS straight to the code we want to execute!</p>

<h3 id="performance-improvement">Performance improvement&hellip;?</h3>

<p>So.. this hash lookup seems faster in theory, but what about in practice? Unfortunately I ended up with some mixed results&hellip;</p>

<p>I created a <a href="http://jsperf.com/switch-vs-hash/3">simple performance test on jsperf.com</a> and got these results:</p>

<table>
  <tr>
    <td>
      Browser
    </td>
    
    <td>
      Switch ops/sec
    </td>
    
    <td>
      Hash table ops/sec
    </td>
    
    <td>
      % Difference
    </td>
  </tr>
  
  <tr>
    <td>
      Chrome 6.0.490.1 dev
    </td>
    
    <td class="negative">
      34,606,469
    </td>
    
    <td class="positive">
      43,329,587
    </td>
    
    <td class="positive">
      25% faster
    </td>
  </tr>
  
  <tr>
    <td>
      Safari 5.0
    </td>
    
    <td class="positive">
      16,777,216
    </td>
    
    <td class="negative">
      10,854,824
    </td>
    
    <td class="negative">
      35% slower
    </td>
  </tr>
  
  <tr>
    <td>
      Opera 10.61
    </td>
    
    <td class="positive">
      4,405,782
    </td>
    
    <td class="negative">
      2,719,336
    </td>
    
    <td class="negative">
      38% slower
    </td>
  </tr>
  
  <tr>
    <td>
      Firefox 3.6.3
    </td>
    
    <td class="positive">
      2,785,802
    </td>
    
    <td class="negative">
      2,400,586
    </td>
    
    <td class="negative">
      14% slower
    </td>
  </tr>
  
  <tr>
    <td>
      IE6
    </td>
    
    <td class="negative">
      147,870
    </td>
    
    <td class="positive">
      206,869
    </td>
    
    <td class="positive">
      40% faster
    </td>
  </tr>
  
  <tr>
    <td>
      IE7
    </td>
    
    <td class="negative">
      144,735
    </td>
    
    <td class="positive">
      191,179
    </td>
    
    <td class="positive">
      32% faster
    </td>
  </tr>
  
  <tr>
    <td>
      IE8
    </td>
    
    <td class="negative">
      350,085
    </td>
    
    <td class="positive">
      472,417
    </td>
    
    <td class="positive">
      35% faster
    </td>
  </tr>
  
  <tr>
    <td>
      Mobile Safari (iOS4 on iPhone 3GS)
    </td>
    
    <td class="positive">
      668,053
    </td>
    
    <td class="negative">
      416,366
    </td>
    
    <td class="negative">
      37% slower
    </td>
  </tr>
  
  <tr>
    <td>
      Android (2.2 on Nexus One)
    </td>
    
    <td class="negative">
      605,693
    </td>
    
    <td class="positive">
      864,591
    </td>
    
    <td class="positive">
      42% faster
    </td>
  </tr>
</table>

<ul>
<li>Ops/sec = Operations per second. Higher is better<br /></li>
<li>Chrome, Safari, Opera, and Firefox were tested on Mac OSX 10.6.4 2.53GHz Intel Core i5. IE tests were run on Windows 7 64bit 2.4GHz Quad Core</li>
</ul>

<h3 id="the-results">The Results</h3>

<p>From the results, it looks like the hash optimization is only a benefit for Chrome, IE6-IE8, and Android. That&rsquo;s quite a specific sampling. My guess is that the other browsers have implemented some sort of Switch statement optimizations that actually turn the hash optimization into an antipattern.</p>

<h3 id="more-info">More info</h3>

<p>Although I first read about this online, by no surprise this trick also appears in <a href="http://www.nczonline.net/">Nicholas Zakas&rsquo;s</a> <a href="http://www.amazon.com/Performance-JavaScript-Faster-Application-Interfaces/dp/059680279X">High Performance JavaScript</a> in a section on &ldquo;Lookup Tables&rdquo; (p. 72).</p>
</div>

    
    

    

    

        <h4 class="page-header">Comments</h4>

        <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "davidbcalhoun" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    

</main>

        <footer role="contentinfo">

            <p class="copyright text-muted">© <span itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="David Calhoun"><a href="mailto:david.b.calhoun@gmail.com" itemprop="email">David Calhoun</a> (<a href="https://twitter.com/franksvalli" itemprop="url">@franksvalli</a>) - <a href="https://www.linkedin.com/in/davidcalhoun" itemprop="url">LinkedIn</a> - <a href="http://themaingate.net/resume/" itemprop="url">Resume</a></span></p>

        </footer>
       
    </body>

</html>

