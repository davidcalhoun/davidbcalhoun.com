
<!DOCTYPE HTML>
<html lang="en-GB">
<head>
	<meta charset="utf-8">
	<title>  | David Calhoun's blog</title>

	<meta name="author" content="David Calhoun">

<meta name="description" content="Earlier this year I gave a talk (slides) outlining the latest and greatest in mobile performance, including a bit of my own unscientific research &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="David Calhoun's blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="/javascripts/html5.js"></script><![endif]-->
	

</head>



<body>
	<header id="header" class="inner"><h1><a href="/">David Calhoun's blog</a></h1>
<span class="tagline"></span>
<!-- <nav id="main-nav"><ul>
	<li><a href="/about">About</a></li>
	<li><a href="/archives">Archives</a></li>
	<li><a href="/contact">Contact</a></li>
</ul>
</nav> -->
<!-- <nav id="mobile-nav"> -->
<!-- 	<div class="alignleft menu"> -->
<!-- 		<a class="button">Menu</a> -->
<!-- 		<div class="container"><ul>
	<li><a href="/about">About</a></li>
	<li><a href="/archives">Archives</a></li>
	<li><a href="/contact">Contact</a></li>
</ul>
</div> -->
<!-- 	</div> -->
<!-- </nav> -->


</header>

	<div id="content" class="inner">


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/2011/mobile-performance-manifesto">
			
				Mobile Performance Manifesto</a>
		</h2>
		<div class="meta date">








  


<time datetime="2011-10-11T00:00:00-07:00" pubdate data-updated="true">Oct 11<span>th</span>, 2011</time></div>
	</header>
	<div class="entry-content">
		<p><img src="http://davidbcalhoun.com/wp-content/uploads/2011/10/odometer.jpg" alt="" title="Dashboard with odometer" width="800" height="299" class="aligncenter size-full wp-image-806" /></p>

<p>Earlier this year I gave a <a href="http://www.meetup.com/SF-Web-Performance-Group/events/16116764">talk</a> (<a href="http://davidbcalhoun.com/present/mobile-performance/">slides</a>) outlining the latest and greatest in mobile performance, including a bit of my own unscientific research into carrier latency and bandwidth thanks to <a href="https://github.com/yahoo/boomerang">boomerang.js</a>.</p>

<p>I realized that interest in mobile performance has exploded recently, especially with <a href="http://www.stevesouders.com/blog/2011/01/10/announcing-my-focus-on-mobile/">Steve Souders announcing his focus on mobile</a>, and I thought it was time for an update, this time in blog form. Also, my old <a href="http://davidbcalhoun.com/present/mobile-performance/">slides</a> have been somewhat embarrassing. For some strange reason, at the time I wanted to give <a href="http://meyerweb.com/eric/tools/s5/">S5</a> a try – that outdated, ancient, not-performant slideshow framework. The result is a slideshow on performance that loads slowly… doh! (incidentally, I recommend <a href="http://imakewebthings.github.com/deck.js/">deck.js</a> as an alternative).</p>

<p>In any case, it was time for a roundup of mobile performance best practices, in blog form. I’m not sure if it’s properly called a manifesto, but it is what it is! Onward!</p>

<h3 id="for-fun-latency-and-bandwidth-tests">For fun: Latency and bandwidth tests</h3>

<p>Before we start.. just a little fun data! It’s always been a pleasure to fiddle around with <a href="https://github.com/yahoo/boomerang">boomerang.js</a> and compare results. With my latest trip to Japan, I had the opportunity to run Boomerang on Japan’s <a href="http://en.wikipedia.org/wiki/EMOBILE_Limited">e-mobile</a> 3G network in the remotest of places, up in Hakuba/Nagano in the Japanese alps.</p>

<p>When I got back, I ran the same tests from downtown San Francisco, which was closer to my California-based test server, and should’ve been faster, right? Theoretically…</p>

<h4 id="boomerang-tests-running-on-a-california-hosted-server">Boomerang Tests (running on a California-hosted server)</h4>

<table style="width: 100%;">
  <th>
    <td>
      Verizon 3G (SF)
    </td>
    
    <td>
      ATT 3G (SF)
    </td>
    
    <td>
      e-mobile 3G (Hakuba)
    </td>
  </th>
  
  <tr>
    <td>
      Latency
    </td>
    
    <td class="positive">
      251ms
    </td>
    
    <td>
      901ms
    </td>
    
    <td>
      401ms
    </td>
  </tr>
  
  <tr>
    <td>
      Bandwidth
    </td>
    
    <td>
      62kbps
    </td>
    
    <td>
      3kbps
    </td>
    
    <td class="positive">
      95kbps
    </td>
  </tr>
</table>

<p>Yes, e-mobile didn’t have the greatest ping, but it handily beat ATT, even though it was going across the entire Pacific Ocean! Note that it came out the best in the bandwidth tests however… </p>

<p>(Note: it’s unknown if or how <a href="http://stevesouders.com/ms/">Steve Souders’s latest research</a> affects these findings)</p>

<p>There’s a lot of factors that could’ve been involved, so look to something like <a href="http://opensignalmaps.com/">OpenSignalMaps</a> for more data.</p>

<p>Ok, onto the tips!</p>

<h3 id="page-organization">Page Organization</h3>

<p><img src="http://davidbcalhoun.com/wp-content/uploads/2011/10/mobile-site-organization.png" alt="" title="Smart phone versus feature phone website organization" width="645" height="633" class="aligncenter size-full wp-image-793" /></p>

<p>For feature phones that have little to no caching, aggressively combine requests (deliver HTML/CSS/JS all in one package). For smart phones, take advantage of caching by mirroring desktop frontend best practices: separate HTML, CSS, and JS so they can be cached (per-session and across sessions).</p>

<p>There’s old research about <a href="http://www.yuiblog.com/blog/2008/02/06/iphone-cacheability/">extremely small cache sizes on iOS in particular</a>, but this research has been followed up on by more recent research by <a href="http://www.yuiblog.com/blog/2010/07/12/mobile-browser-cache-limits-revisited/">Ryan Grove (Yahoo!)</a> and <a href="http://www.stevesouders.com/blog/2010/07/12/mobile-cache-file-sizes/">Steve Souders (Google)</a>, which shows that we shouldn’t be so paranoid, since caching is pretty decent across all the major mobile browsers.</p>

<p>Of particular interest is a browser’s capability to cache files in a current session, browsing from page-to-page, which is what most users will end up doing (caching of the page across sessions is another matter). What is the maximum file size a browser will cache during a session? The <a href="http://www.browserscope.org/user/tests/table/agt1YS1wcm9maWxlcnINCxIEVGVzdBj_1OsBDA?v=3&#038;layout=simple&#038;f=Max%20js%20Cache%20Size%20(kB)">results (via Browserscope)</a> end up being encouraging:</p>

<table style="width: 100%;">
  <th>
    <td>
      Maximum Cache Size (MB)
    </td>
  </th>
  
  <tr>
    <td>
      Android 2.1
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      Android 2.2
    </td>
    
    <td>
      2
    </td>
  </tr>
  
  <tr>
    <td>
      Android 2.3
    </td>
    
    <td>
      2
    </td>
  </tr>
  
  <tr>
    <td>
      Android 3.0
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      Blackberry 6.0.0
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      iPad 4.3.5
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      iPad 5.0
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      iPhone 4.3.5
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      iPhone 5.0
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      Opera Mini 4
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      Opera Mini 5
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      Opera Mini 6
    </td>
    
    <td>
      4+
    </td>
  </tr>
  
  <tr>
    <td>
      webOS 2.0
    </td>
    
    <td>
      1
    </td>
  </tr>
</table>

<h3 id="avoid-redirects-foocom---mfoocom">Avoid redirects (foo.com -&gt; m.foo.com)</h3>

<p>If possible, perform the redirection behind the scenes on the server, which should be transparent to the user. When a user performs a Google search and clicks on your page, they’re already getting redirected once by Google (check it yourself). Your own redirects are adding a second redirect where there need not be one.</p>

<h3 id="optimize-images">Optimize Images</h3>

<p><a href="http://filamentgroup.com/examples/responsive-images-new/demos/A-Default/demo.html"><img src="http://davidbcalhoun.com/wp-content/uploads/2011/10/responsive-images.jpg" alt="" title="Responsive images" width="600" height="423" class="aligncenter size-full wp-image-796" /></a><br />
Deliver appropriately-sized images to devices. The philosophy of responsive design makes it easy to simply downscale images to fit the screen, but avoid this where possible, as this means wasted bandwidth.</p>

<p>You can optimize images through CSS media queries or in JavaScript (see below). Though you want to reduce your dependence on cookies, it may be a good idea to store these width/height values into a cookie (or localStorage if you are fetching images in nontraditional ways) so the values can be read by the server, which can deliver appropriately-sized images. This technique has been <a href="http://filamentgroup.com/lab/responsive_images_experimenting_with_context_aware_image_sizing/">implemented by Filament Group</a>, so you should probably read about their experiences before trying to roll your own.</p>

<p>Also note that where applicable, at the expense of performance you may want to serve higher resolution images for better screens, such as for Retina displays (which can be detected with JavaScript or CSS).</p>

<h4 id="javascript-examples">JavaScript examples</h4>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
</pre></td>
  <td class="code"><pre>window.innerHeight;       <span class="comment">// max height actually available</span>
window.innerWidth;        <span class="comment">// max width actually available</span>
window.devicePixelRatio;  <span class="comment">// pixel density (standard is 1, high resolution is generally &gt; 1)</span>
</pre></td>
</tr></table>
</div>

<p>(note that <code>screen.width</code> and <code>screen.height</code> are also available to tell you the dimensions of the entire screen, but this isn’t all available due to the space taken by the OS and browser chrome)</p>

<h4 id="media-query-examples">Media query examples</h4>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
<strong><a href="#n10" name="n10">10</a></strong>
<a href="#n11" name="n11">11</a>
<a href="#n12" name="n12">12</a>
<a href="#n13" name="n13">13</a>
<a href="#n14" name="n14">14</a>
</pre></td>
  <td class="code"><pre><span class="directive">@media</span> <span class="type">only</span> <span class="error">s</span><span class="error">c</span><span class="error">r</span><span class="error">e</span><span class="error">e</span><span class="error">n</span> <span class="error">a</span><span class="error">n</span><span class="error">d</span> (<span class="error">m</span><span class="error">a</span><span class="error">x</span><span class="error">-</span><span class="error">w</span><span class="error">i</span><span class="error">d</span><span class="error">t</span><span class="error">h</span>: <span class="float">480px</span>) {
  <span class="comment">/* small screen styles */</span>
}

<span class="directive">@media</span> <span class="type">only</span> <span class="error">s</span><span class="error">c</span><span class="error">r</span><span class="error">e</span><span class="error">e</span><span class="error">n</span> <span class="error">a</span><span class="error">n</span><span class="error">d</span> (<span class="error">m</span><span class="error">i</span><span class="error">n</span><span class="error">-</span><span class="error">w</span><span class="error">i</span><span class="error">d</span><span class="error">t</span><span class="error">h</span>: <span class="float">481px</span>) {
  <span class="comment">/* large screen styles */</span>
}

<span class="directive">@media</span> (<span class="type">-webkit-min-device-pixel-ratio</span>: <span class="float">1.5</span>),
       (<span class="error">-</span><span class="error">o</span><span class="error">-</span><span class="error">m</span><span class="error">i</span><span class="error">n</span><span class="error">-</span><span class="error">d</span><span class="error">e</span><span class="error">v</span><span class="error">i</span><span class="error">c</span><span class="error">e</span><span class="error">-</span><span class="error">p</span><span class="error">i</span><span class="error">x</span><span class="error">e</span><span class="error">l</span><span class="error">-</span><span class="error">r</span><span class="error">a</span><span class="error">t</span><span class="error">i</span><span class="error">o</span>: <span class="float">3</span>/<span class="float">2</span>),
       (<span class="error">m</span><span class="error">i</span><span class="error">n</span><span class="error">-</span><span class="error">-</span><span class="error">m</span><span class="error">o</span><span class="error">z</span><span class="error">-</span><span class="error">d</span><span class="error">e</span><span class="error">v</span><span class="error">i</span><span class="error">c</span><span class="error">e</span><span class="error">-</span><span class="error">p</span><span class="error">i</span><span class="error">x</span><span class="error">e</span><span class="error">l</span><span class="error">-</span><span class="error">r</span><span class="error">a</span><span class="error">t</span><span class="error">i</span><span class="error">o</span>: <span class="float">1.5</span>),
       (<span class="error">m</span><span class="error">i</span><span class="error">n</span><span class="error">-</span><span class="error">d</span><span class="error">e</span><span class="error">v</span><span class="error">i</span><span class="error">c</span><span class="error">e</span><span class="error">-</span><span class="error">p</span><span class="error">i</span><span class="error">x</span><span class="error">e</span><span class="error">l</span><span class="error">-</span><span class="error">r</span><span class="error">a</span><span class="error">t</span><span class="error">i</span><span class="error">o</span>: <span class="float">1.5</span>) {
  <span class="comment">/* high resolution styles */</span>
}
</pre></td>
</tr></table>
</div>

<h3 id="navigatorconnection-android-only">navigator.connection (Android only)</h3>

<p>Use <a href="http://davidbcalhoun.com/2010/using-navigator-connection-android">navigator.connection</a> if it’s available to serve different assets based on connection speed (3G vs WIFI, for instance).</p>

<p>Here’s the contents of the <code>navigator.connection</code> object (with a phone running on a 3G connection):</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
</pre></td>
  <td class="code"><pre>{
  <span class="key">type</span>: <span class="integer">4</span>,
  <span class="key">UNKNOWN</span>: <span class="integer">0</span>,
  <span class="key">ETHERNET</span>: <span class="integer">1</span>,
  <span class="key">WIFI</span>: <span class="integer">2</span>,
  <span class="key">CELL_2G</span>: <span class="integer">3</span>,
  <span class="key">CELL_3G</span>: <span class="integer">4</span>
}
</pre></td>
</tr></table>
</div>

<p>And an example of how you could write code for each type:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
<strong><a href="#n10" name="n10">10</a></strong>
</pre></td>
  <td class="code"><pre>(<span class="keyword">function</span>(){  <span class="comment">// sandbox our code</span>
  <span class="keyword">if</span>(!navigator.connection) navigator.connection = {<span class="key">type</span>:<span class="integer">0</span>, <span class="key">UNKNOWN</span>: <span class="integer">0</span>};  <span class="comment">// polyfill</span>
  <span class="keyword">var</span> connection = navigator.connection;
  
  <span class="keyword">if</span>(connection.type === connection.WIFI || connection.type === connection.ETHERNET) {
    <span class="comment">// high bandwidth</span>
  } <span class="keyword">else</span> {
    <span class="comment">// normal bandwidth</span>
  }
})();
</pre></td>
</tr></table>
</div>

<p>Here’s how we might be able to use <a href="http://modernizr.com/">Modernizr</a> to help us out:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
<strong><a href="#n10" name="n10">10</a></strong>
</pre></td>
  <td class="code"><pre>(<span class="keyword">function</span>(){  <span class="comment">// sandbox our code</span>
  <span class="keyword">if</span>(!navigator.connection) navigator.connection = {<span class="key">type</span>:<span class="integer">0</span>, <span class="key">UNKNOWN</span>: <span class="integer">0</span>};  <span class="comment">// polyfill</span>
  <span class="keyword">var</span> connection = navigator.connection;
  
  <span class="comment">// add a custom test to Modernizr</span>
  Modernizr.addTest(<span class="string"><span class="delimiter">'</span><span class="content">highbandwidth</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(){
    <span class="keyword">return</span> connection.type === connection.WIFI || connection.type === connection.ETHERNET;
  });

})();
</pre></td>
</tr></table>
</div>

<p>We can now target special high-bandwidth assets with CSS:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
</pre></td>
  <td class="code"><pre><span class="class">.highbandwidth</span> <span class="class">.logo</span> {<span class="key">background-image</span>:<span class="function"><span class="delimiter">url(</span><span class="content">'logo-high.jpg'</span><span class="delimiter">)</span></span>;}
<span class="class">.no-highbandwidth</span> <span class="class">.logo</span> {<span class="key">background-image</span>:<span class="function"><span class="delimiter">url(</span><span class="content">'logo.jpg'</span><span class="delimiter">)</span></span>;}
</pre></td>
</tr></table>
</div>

<h3 id="base64-encode-small-ui-images">base64 encode small UI images</h3>

<p>You can base64 encode binary image data in HTML and CSS:</p>

<h4 id="html">HTML</h4>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
</pre></td>
  <td class="code"><pre><span class="tag">&lt;img</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA</span>
<span class="content">AAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO</span>
<span class="content">9TXL0Y4OHwAAAABJRU5ErkJggg==</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Red dot</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
</pre></td>
</tr></table>
</div>

<h4 id="css">CSS</h4>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
</pre></td>
  <td class="code"><pre><span class="class">.dot</span> {
  <span class="key">background-image</span>: <span class="function"><span class="delimiter">url(</span><span class="content">'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA  </span></span>
<span class="value">AAAFCAYAAACNbyblAAAAHElEQVQI12P4</span>//<span class="float">8</span>/<span class="value">w38GIAXDIBKE0DHxgljNBAAO</span>  
<span class="float">9</span><span class="value">TXL0Y4OHwAAAABJRU5ErkJggg</span>==<span class="string"><span class="delimiter">'</span><span class="content">)</span><span class="delimiter">;</span></span>
}
</pre></td>
</tr></table>
</div>

<p>There seems to be the mistaken belief floating around that base64 images aren’t cacheable. However, because you can embed them in your CSS, base64 encoded images will be cached along with the rest of your CSS.</p>

<p>You’ll probably just want to limit this to small UI icons however. I wrote a <a href="http://davidbcalhoun.com/2011/when-to-base64-encode-images-and-when-not-to">quick post on the drawbacks, and also a comparison with sprites</a>.</p>

<p>If you’re using Compass/SASS, base64 encoding images is pretty trivial and easy to maintain with the <a href="http://compass-style.org/reference/compass/helpers/inline-data/">inline-image helper</a>.</p>

<h3 id="unicode-and-emoji">Unicode and Emoji</h3>

<p>☆ (HTML entity: #9734)<br />
<img src="http://davidbcalhoun.com/wp-content/uploads/2011/10/emoji3.png" alt="" title="Emoji" width="18" height="18" /> (HTML entity: <code>#x1f468</code>)</p>

<p>Before even considering base64 images, take advantage of icons that are already made for you: unicode characters and <a href="http://pukupi.com/post/1964">emoji</a> (where supported). Keep in mind that these will look different across browsers, so this might not be an option for everyone.</p>

<p>Because of inconsistent implementations of Emoji character codes between Asian carriers, representatives from Apple and Google made a <a href="http://en.wikipedia.org/wiki/Emoji#Emoji_in_the_Unicode_standard">proposal to add Emoji to the Unicode standard</a>. Unfortunately it seems that only iPhone supports them for now. Here’s a <a href="http://www.unicode.org/charts/PDF/U1F300.pdf">handy chart of all the Unicode emoji characters available</a>.</p>

<h3 id="take-advantage-of-css3">Take advantage of CSS3</h3>

<p>CSS3 offers many replacements for things we needed images for previously. RGBA values replace the need for a semitransparent image for overlays and such. Likewise, border-radius, box shadow, linear-gradients, radial-gradients all reduce the need for images.</p>

<p>However, do be aware that though phones support these new features, it doesn’t mean they’re necessarily ready for primetime. Something I’ve encountered recently to remind me of this fact is <a href="http://code.google.com/p/android/issues/detail?id=767">severe color banding issues when using a CSS radial gradient</a>. The solution was to fake the radial gradient using two linear gradients, or to (unfortunately) use an old-fashioned image.</p>

<h3 id="avoid-using-cookies">Avoid using cookies</h3>

<p>Cookies get thrown into <em>every</em> request on a per-domain basis, so limit your usage of them. Use localStorage/sessionStorage instead, where possible.</p>

<h3 id="app-cache">App cache</h3>

<p>Take advantage of the HTML5 app cache, though it’s an unwieldy beast to tame. This will mean you will need to make your site work offline, which might be tricky.</p>

<p>Assets that are traditionally cached get rechecked on page refresh (the server sends back a 304 response if your cache is still up-to-date). Whereas with the app cache, only one file (your manifest) is rechecked on page load.</p>

<h3 id="deferred-javascript-execution">Deferred JavaScript execution</h3>

<p><img src="http://davidbcalhoun.com/wp-content/uploads/2011/10/gmail-deferred-javascript-execution.png" alt="" title="Gmail deferred JavaScript execution" width="497" height="450" class="aligncenter size-full wp-image-810" /></p>

<p>We know that deferring downloading of scripts is advantageous (by placing scripts at the bottom of a page or by using the <code>async</code> attribute), but deferred execution of JavaScript is even more important. Sure, we can use the <code>defer</code> attribute, but that’s only really relevant for when the page is loading (<code>defer</code> lets the browser know that the UI doesn’t depend on the JavaScript, so it can be safely deferred).</p>

<p>But what about JavaScript that runs after the page loads, such as XHR and JSONP requests? What does this mean for the user? It means that the UI freezes up unexpectedly when JavaScript is being downloaded and executed in the background. But this doesn’t mean that you want to completely avoid background downloading of JavaScript. The Gmail mobile team came up with a <a href="http://googlecode.blogspot.com/2009/09/gmail-for-mobile-html5-series-reducing.html">clever solution</a>: by commenting all of their code and dynamically eval’ing it when needed, they split up the JavaScript downloading from its execution.</p>

<h3 id="perceived-performance">Perceived performance</h3>

<p>Do whatever you have to do to let the user know that the UI is still responding. This sometimes means faking that something is happening. Communication is key! If they clicked on a button, give some indication that they clicked on it. If they clicked on something that requires a request to the network, show a spinner right away, even if it means you haven’t even sent out a request. The user doesn’t need to know the nitty-gritty details – they just want to know that their intent was communicated.</p>

<h3 id="onclick-delay">Onclick delay</h3>

<p>On several major mobile operating systems there’s a several hundred millisecond delay on the onclick event. This is because of the double-tap-to-zoom functionality. When a user first taps on the screen, there’s a hard-coded delay that waits for the second tap. If there’s no second tap, the onclick event is then fired. Unfortunately the only way to get around the delay is to tap into touch events instead, which is a bit more complicated than it appears on first glance.</p>

<p>For an overview of some of the challenges of implementing the workaround, see <a href="http://code.google.com/mobile/articles/fast_buttons.html">this article by Google’s Ryan Fioravanti</a>.</p>

<h3 id="take-advantage-of-hardware-acceleration">Take advantage of hardware acceleration</h3>

<p>Use hardware-accelerated CSS transforms where possible (translate3d, translateZ, rotate3d, and scale3d). An element that is hardware accelerated is turned into a graphic, which is perfect for the GPU to manipulate, taking away the burden from the CPU.</p>

<p>However, the GPU isn’t all-powerful, so don’t try to apply hardware accelerations to everything. Also, these elements still need to be refreshed periodically, and it turns out that you can make some good optimizations here. First, you’ll want to debug the composited layers on your desktop browser:</p>

<h4 id="debugging-hardware-acceleration">Debugging hardware acceleration</h4>

<p><a href="http://www.webkit.org/blog-files/3d-transforms/poster-circle.html"><img src="http://davidbcalhoun.com/wp-content/uploads/2011/10/debug-composited-layers-hardware-acceleration.png" alt="" title="WebKit&#039;s poster circle demo with and without the debug information" width="767" height="399" class="aligncenter size-full wp-image-803" /></a><br />
<em>Chrome</em></p>

<ol>
  <li>Type the following in the address bar: about:flags</li>
  <li>“Composited render layer borders” -&gt; Enable</li>
</ol>

<p><em>Safari</em></p>

<ol>
  <li>Open a terminal</li>
  <li>$ defaults write com.apple.Safari IncludeInternalDebugMenu 1</li>
  <li>$ defaults write com.apple.Safari CA_COLOR_OPAQUE 1</li>
  <li>Open (or restart) Safari</li>
  <li>Debug -&gt; Show Compositing Borders</li>
</ol>

<p>(to turn these off, run the same commands with a boolean FALSE: i.e. <code>defaults write com.apple.Safari CA_COLOR_OPAQUE FALSE</code>)</p>

<p>Keep in mind that each composited layer has a limited width and height. For instance, if you’re creating an image carousel, chances are the dimensions of the element will be too big to fit the layer into memory as one piece. This means that when the element is animated, the GPU has to break up the layer manually into several manageable chunks. It’s much better to chunk it yourself. To do this, you trigger hardware acceleration on each chunk.</p>

<p>So you will change this:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
</pre></td>
  <td class="code"><pre><span class="class">.carousel</span> {
  <span class="key">-webkit-transform</span>: <span class="error">t</span><span class="error">r</span><span class="error">a</span><span class="error">n</span><span class="error">s</span><span class="error">l</span><span class="error">a</span><span class="error">t</span><span class="error">e</span><span class="float">3</span><span class="error">d</span>(<span class="float">0</span>,<span class="float">0</span>,<span class="float">0</span>);  <span class="comment">/* or translateZ(0); */</span>
}
</pre></td>
</tr></table>
</div>

<p>To this:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
</pre></td>
  <td class="code"><pre><span class="class">.carousel</span> {
  <span class="key">-webkit-transform</span>: <span class="error">t</span><span class="error">r</span><span class="error">a</span><span class="error">n</span><span class="error">s</span><span class="error">l</span><span class="error">a</span><span class="error">t</span><span class="error">e</span><span class="float">3</span><span class="error">d</span>(<span class="float">0</span>,<span class="float">0</span>,<span class="float">0</span>);  <span class="comment">/* or translateZ(0); */</span>
}

<span class="class">.carousel-pane</span> {
  <span class="key">-webkit-transform</span>: <span class="error">t</span><span class="error">r</span><span class="error">a</span><span class="error">n</span><span class="error">s</span><span class="error">l</span><span class="error">a</span><span class="error">t</span><span class="error">e</span><span class="float">3</span><span class="error">d</span>(<span class="float">0</span>,<span class="float">0</span>,<span class="float">0</span>);  <span class="comment">/* or translateZ(0); */</span>
}
</pre></td>
</tr></table>
</div>

<p>Where carousel-pane represents each child element of the carousel.</p>

<p>More info: <a href="http://dl.dropbox.com/u/5618867/mseeley-2011-09-27-html5devconf.pdf">(slides) WebKit in Your Living Room (Matt Seeley, Netflix)</a></p>

<p>Also see <a href="http://www.html5rocks.com/en/mobile/optimization-and-performance.html">HTML5 Techniques for Optimizing Mobile Performance</a>.</p>

<h3 id="http-pipelining">HTTP Pipelining</h3>

<p><a href="http://www.blaze.io/mobile/http-pipelining-big-in-mobile/"><img src="http://davidbcalhoun.com/wp-content/uploads/2011/10/pipelining.png" alt="HTTP Pipelining diagram" title="HTTP Pipelining (via Blaze.io)" width="640" height="445" class="aligncenter size-full wp-image-783" /></a></p>

<p>Take advantage of <a href="http://www.blaze.io/mobile/http-pipelining-big-in-mobile/">HTTP Pipelining</a>, which is often overlooked, but has broad support on mobile. This virtually eliminates round trip times, for all but the first request.</p>

<p>Opera and Android support pipelining, and the newly released iOS 5 has added support for it.</p>

<p>Great! So how do you make sure your server is taking advantage of pipelining?</p>

<blockquote>
  <p>The first request to every server is sent by itself (only one request on the connection), and the browser looks for two properties in the response:</p>

  <ol>
    <li>Use of HTTP/1.1</li>
    <li>An explicit “Connection: Keep-Alive” header (required by Android)</li>
  </ol>

  <p><a href="http://www.blaze.io/mobile/http-pipelining-big-in-mobile/">-Blaze.io</a> </p>
</blockquote>

<p>If these criteria are met, subsequent requests will be pipelined. Sweet!</p>

<h3 id="dns-prefetching">DNS Prefetching</h3>

<p>Take advantage of <a href="https://developer.mozilla.org/En/Controlling_DNS_prefetching">DNS Prefetching</a>. This theoretically speeds up load times, but there have been <a href="http://www.mydigitallife.info/turn-off-dns-prefetching-in-google-chrome-to-fix-resolving-host-and-cannot-load-page-error/">some issues</a>, so be sure to test it.</p>

<p>To turn off DNS Prefetching, serve this meta tag:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
</pre></td>
  <td class="code"><pre><span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x-dns-prefetch-control</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">off</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
</pre></td>
</tr></table>
</div>

<p>You can also explicitly force a DNS lookup:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
</pre></td>
  <td class="code"><pre><span class="tag">&lt;link</span> <span class="attribute-name">rel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dns-prefetch</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.example.com/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
</pre></td>
</tr></table>
</div>

<h3 id="avoid-library-code-bloat">Avoid library code bloat</h3>

<p>If you’re developing for smart phones, you may be able to dramatically reduce the data over the wire by simply using new JavaScript APIs instead of a full-blown library or framework such as jQuery Mobile (which is rather a UI framework and depends on the desktop version of jQuery).</p>

<p>Among the things offered by newer browsers, which should reduce your dependence on a library:</p>

<ul>
  <li><a href="https://developer.mozilla.org/En/DOM/Document.querySelector">querySelector</a>/<a href="https://developer.mozilla.org/en/DOM/document.querySelectorAll">querySelectorAll</a>: CSS selectors that replace the need for a selector engine</li>
  <li><a href="https://developer.mozilla.org/en/DOM/document.getElementsByClassName">getElementsByClassName</a></li>
  <li><a href="https://developer.mozilla.org/en/DOM/element.classList">classList</a> – replaces the need for hasClass, addClass, removeClass helpers (available on iOS5, but not sure what else)</li>
  <li><a href="https://developer.mozilla.org/En/XMLHttpRequest/Using_XMLHttpRequest">XMLHttpRequest</a> – it’s probably time to learn how to do this natively instead of using a wrapper that takes care of IE’s old implementation that requests an ActiveX object. <a href="http://hacks.mozilla.org/2009/07/cross-site-xmlhttprequest-with-cors/">Cross-Origin Resource Sharing</a> also means we can easily share resources across domains.</li>
  <li><a href="https://developer.mozilla.org/en/DOM/Manipulating_the_browser_history">HTML5 history (pushState, etc)</a> – though an <a href="https://bugs.webkit.org/show_bug.cgi?id=42940">older bug</a> means you should maybe hold off for now (note: the fix is present in iOS 5, which is based on a newer WebKit)</li>
  <li><a href="http://www.the-art-of-web.com/html/html5-form-validation/">HTML5 Form Validation</a> reduces our need for JavaScript-based validation</li>
  <li>HTML5 input types that reduce our need for custom UI controls (date, time, slider [range], etc)</li>
</ul>

<p>You’ll want to consider using either a library that was optimized for the browsers you’re targeting (such as <a href="http://zeptojs.com/">Zepto.js</a>) or simply bring in <a href="http://microjs.com/">a microlibrary for specific tasks you want to perform</a>.</p>

<h3 id="clientside-databases">Clientside databases</h3>

<p>Most mobile browsers currently support WebSQL, which is being phased out in support of indexedDB, which is not widely implemented. However, if you use a wrapper such as <a href="http://westcoastlogic.com/lawnchair/">Lawnchair</a>, the transition from one to the other is relatively painless.</p>

<h3 id="todo-testing">TODO: testing</h3>

<h3 id="more">More</h3>

<p>(to be expanded on later)</p>

<ul>
  <li>use standard desktop best practices (for smart phones)</li>
  <li>requestAnimationFrame instead of setTimeout</li>
  <li>setImmediate (where available) instead of setTimeout(fn(){},0)</li>
  <li>Ajax parsing times: you might want to use Multipart XHR so you can yield the process as it’s going through big responses (to prevent the UI locking up)</li>
  <li>avoid rgba, box shadows, text shadow, etc, as this greatly degrades performance (especially on animations)</li>
  <li>high resolution screens may suffer from animation/transition slowness – it’s been shown that manipulating the viewport tag to scale the page <a href="http://29a.ch/2011/5/27/fast-html5-canvas-on-iphone-mobile-safari-performance">will speed up canvas rendering</a>, and <a href="http://paulbakaus.com/2011/10/10/scroller-vs-scrollability-deathmatch/">high-dpi scaling concerns are also evident in CSS transforms</a></li>
  <li><a href="http://joehewitt.com/2011/10/05/fast-animation-with-ios-webkit">WebKit animations are faster than animations done via JavaScript</a></li>
  <li>if you do use JavaScript-based animations, limit the UI updates to ~17ms, which is equivalent to 60fps, which is the fastest your display will refresh anyway, so it’s pointless to try to do anything faster than that. Keep track of the time since the last UI update and don’t do anything if 17ms haven’t passed.</li>
</ul>

<h3 id="on-the-horizon8230">On the horizon…</h3>

<ul>
  <li><a href="http://www.chromium.org/spdy">SPDY</a>: already implemented in Amazon’s Silk browser for Kindle. Will possibly be on Android phones <a href="http://androidandme.com/2011/10/news/google-chrome-is-finally-coming-to-an-android-device-near-you/">when the browser is powered by Chrome</a></li>
  <li>indexedDB replacing WebSQL</li>
</ul>

<h3 id="tools">Tools</h3>

<p><a href="http://stevesouders.com/mobileperf/mobileperfbkm.php">Mobile Perf bookmarklet</a><br />
<a href="http://calendar.perfplanet.com/2010/mobile-performance-analysis-using-pcapperf/">pcapperf (Packet Capture Web Performance Analyzer)</a><br />
<a href="http://www.blaze.io/mobile/">Blaze Mobitest</a> – tests the loading time of your site on actual phones</p>

<h3 id="more-resources">More Resources</h3>

<p><a href="http://www.w3.org/TR/mwabp/">Mobile Web Application Best Practices</a><br />
<a href="http://stevesouders.com/mobileperf/">Mobile Performance (Steve Souders)</a><br />
<a href="http://www.strangeloopnetworks.com/web-performance-optimization-hub/topics/mobile/">Strangeloop Web Performance Hub / Mobile</a></p>

<p>(odometer image via <a href="http://www.flickr.com/photos/henrybloomfield/4442900025/">henrybloomfield on Flickr</a>)</p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/2011/when-to-base64-encode-images-and-when-not-to">
			
				When to Base64 Encode Images (and When Not To)</a>
		</h2>
		<div class="meta date">








  


<time datetime="2011-08-28T00:00:00-07:00" pubdate data-updated="true">Aug 28<span>th</span>, 2011</time></div>
	</header>
	<div class="entry-content">
		<h3 id="introduction">Introduction</h3>

<p>Ever since Steve Souders started evangelizing web performance, it’s been pounded into our heads that extra HTTP requests add a lot of additional overhead, and that we should combine them if possible to dramatically decrease the load time of our web pages.</p>

<p>The practical implication of this has been to combine our JavaScript and CSS files, which is relatively easy and straightforward, but the harder question has been what to do with images.</p>

<h4 id="sprites">Sprites</h4>

<p>Image sprites are a concept taken from video games: the idea is to cram a ton of image assets into one file, and rearrange a “viewport” of sorts to view only specific pieces of that file at a time. For instance, a simple sprite that holds two images might have one viewport that only looks at the top half of the sprite (image #1), and another viewport that only looks at the bottom half (image #2).</p>

<p>On the web side of things, this means that those multiple requests have now been combined into one request. This is nice because it saves both the overhead of additional HTTP requests as well as the overhead of setting up an image’s <a href="http://en.wikipedia.org/wiki/Portable_Network_Graphics#File_header">file header</a> each time.</p>

<p>But there’s a few drawbacks with using image sprites:</p>

<ul>
  <li>hard to maintain and update: without some tool to help, manually editing and putting together image sprites is quite a chore</li>
  <li><a href="http://blog.vlad1.com/2009/06/22/to-sprite-or-not-to-sprite/">increased memory consumption</a> (possibly very dramatic): this is often overlooked. The time to deliver the images is decreased at the expense of a bigger memory and CPU footprint, especially for large sprites and sprites with a lot of whitespace. </li>
  <li>bleedthrough: for sprites that don’t have much whitespace to separate images, there’s an increased chance of nearby images visibly bleeding through other elements, as in this case where bleedthrough was only seen on iOS (but looked fine on Chrome and Safari on the desktop). Note the bleedthrough under the CNN logo:<a href="http://davidbcalhoun.com/wp-content/uploads/2011/08/image-sprite-bleedthrough-example.png"><img src="http://davidbcalhoun.com/wp-content/uploads/2011/08/image-sprite-bleedthrough-example.png" alt="Example of image sprite bleedthrough on Reddit" width="360" height="75" class="aligncenter size-full wp-image-1157" /></a></li>
</ul>

<h4 id="data-uris-and-base64-encoding">Data URIs and Base64 encoding</h4>

<p>Data URIs (see <a href="http://www.phpied.com/data-urls-what-are-they-and-how-to-use/">this</a>, <a href="http://css-tricks.com/5970-data-uris/">this</a>, and <a href="http://www.nczonline.net/blog/2010/07/06/data-uris-make-css-sprites-obsolete/">this</a>) and Base64 encoding goes hand-in-hand. This method allows you to embed images right in your HTML, CSS, or JavaScript.</p>

<p>Just like sprites, you save HTTP requests, but there’s also some drawbacks:</p>

<ul>
  <li>base64 encoding makes file sizes <a href="http://en.wikipedia.org/wiki/Base64">roughly 33% larger</a> than their original binary representations, which means more data down the wire (this might be exceptionally painful on mobile networks)</li>
  <li>data URIs aren’t supported on IE6 or IE7</li>
  <li>base64 encoded data may possibly take longer to process than binary data (anyone want to do a study on this?) (again, this might be exceptionally painful for mobile devices, which have more limited CPU and memory) (side note: <a href="http://twitter.com/#!/stoyanstefanov/status/106605257265655809">CSS background-images seem to actually be faster than img tags</a>)</li>
</ul>

<p>The “33% larger” claim is generally accepted truth now, despite the fact that the figure varies wildly depending on the type of content. This is exactly what I wanted to test, albeit in a pretty limited and nonscientific way.</p>

<p>Before I tested, I wanted to keep in mind a few <em>unverified intuitions</em> (which aren’t entirely my own, but seem to be ideas that are floating around out there). Here’s a few questions I had before going to test:</p>

<ul>
  <li>Is base64 encoding with gzipping roughly equal to the original filesize of the binary file?</li>
  <li>Is base64 encoding best for small images?</li>
  <li>Is base64 encoding best for small and simple icons and not good for pictures and photos?</li>
  <li>Is base64 encoding best when multiple files are merged together?</li>
</ul>

<p>There’s something else I wanted to test: whether Gzipping binary image data made much difference. I know text compresses well, but is it even worth compressing JPEG files with Gzip, for instance?</p>

<p>I ran three tests: one with a set of small UI icons, one with a set of small photographs, and one with a set of the same photographs in a larger size. Though my tests were by no means extensive, they do show that care should be taken in making assumptions about base64.</p>

<p>Just a note about the tables: they are comparing the binary form (original png or jpeg) with the base64 form as it would appear in a CSS stylesheet, and comparing each of those with their gzipped form, which is most likely how they would be sent down the wire. The CSS representation has a few practical declarations and looks something like this:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
</pre></td>
  <td class="code"><pre><span class="class">.address-book--arrow</span> {
  <span class="key">background-image</span>: <span class="function"><span class="delimiter">url(</span><span class="content">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAp1JREFUeNqEU21IU1EYfu7unW5Ty6aBszYs6MeUjGVYokHYyH5E1B9rZWFEFPQnAwmy6Hc/oqhfJsRKSSZGH1JIIX3MNCsqLTD9o1Oj6ebnnDfvvefezrnbdCHhCw/n433P8z7nPe/hBEEAtX0U7hc164uwuvVSXKwZLoOmaRDim+7m9vZa0WiEKSUFFpNpCWlmMyypqTDRuYn6t3k8vmQ2gRDCxs0t9fW45F52aBTROJLtZl7nEZad2m+KtoQCQ0FBARyOCGRZ/q92I1WgqqXlfdd95VsrK8/pChIEqqpCkiQsiCII0aBQZZoWl8lzFDwsFjMl0DBLY8Lj41hBwK4jSQrWOIphL6xYyhwJDWGo6wFSaH1Y3PTCAsITE1oyAa8flhWkbSiCLX8vun11eiGIpiJ/z2nYdx5HqLdVV7elrOzsuqysL3rmBIGiKPizKCHHWY4PLVeQbnXAdegqdhy+hu8dDTBnbqQJZJ1A7u+vz7RaiymWCZgCRSF6Edk8b9cx+B/W6WuVxPaZnyiqXoPpyUmVYvkKTIFClHigEieKjYuSvETUllaF4GAUM1NT6ooaJDKx+aDfC9fByxj90REb+9ppmIoAscH/6leg8MS9DJXPAM9xHCM443K57C6biMjcHDaVVCHw9RmCA2/RGC5C00AqXk/m4p20HZK4CM/J3Zk9n0ecMBhDQnJHcrTisyMfdQXOilrdMfxcwoHq/fg5R59TiQV3hYGKo6X2J/c7LyQIjOx9GXhOw/zoJ8wEevRGyp53o/lGMNYsBgPtEwLecwov7/jGDKa1twT6o3KpL4MdZgGsWZLtfPr7f1q58k1JNHy7YYaM+J+K3Y2PmAIbRavX66229hrGVvvL5uzsHDEUvUu+NT1my78CDAAMK1a8/QaZCgAAAABJRU5ErkJggg==</span><span class="delimiter">)</span></span>;  
  <span class="key">width</span>: <span class="float">16px</span>;
  <span class="key">height</span>: <span class="float">16px</span>;
  <span class="key">background-repeat</span>: <span class="value">no-repeat</span>;
}
</pre></td>
</tr></table>
</div>

<p>Ok, onto the tests!</p>

<h3 id="test-1-five-1621516-icons-from-the-fugue-icon-set9-png">Test #1: Five 16×16 icons from the <a href="http://p.yusukekamiyamane.com/">Fugue Icon set</a> (PNG)</h3>

<table style="width: 100%;">
  <tr>
    <td>
      File
    </td>
    
    <td>
      Binary
    </td>
    
    <td>
      Binary Gzipped
    </td>
    
    <td>
      CSS + Base64
    </td>
    
    <td>
      CSS + Base64 Gzipped
    </td>
  </tr>
  
  <tr>
    <td>
      abacus
    </td>
    
    <td>
      1443
    </td>
    
    <td class="positive">
      1179
    </td>
    
    <td>
      2043
    </td>
    
    <td>
      1395
    </td>
  </tr>
  
  <tr>
    <td>
      acorn
    </td>
    
    <td>
      1770
    </td>
    
    <td class="positive">
      1522
    </td>
    
    <td>
      2478
    </td>
    
    <td>
      1728
    </td>
  </tr>
  
  <tr>
    <td>
      address-book&#8211;arrow
    </td>
    
    <td class="positive">
      763
    </td>
    
    <td>
      810
    </td>
    
    <td>
      1153
    </td>
    
    <td>
      948
    </td>
  </tr>
  
  <tr>
    <td>
      address-book&#8211;exclamation
    </td>
    
    <td class="positive">
      795
    </td>
    
    <td>
      848
    </td>
    
    <td>
      1199
    </td>
    
    <td>
      988
    </td>
  </tr>
  
  <tr>
    <td>
      address-book&#8211;minus
    </td>
    
    <td class="positive">
      734
    </td>
    
    <td>
      781
    </td>
    
    <td>
      1113
    </td>
    
    <td>
      919
    </td>
  </tr>
  
  <tr>
    <td>
      Total
    </td>
    
    <td>
      5,505
    </td>
    
    <td class="positive">
      5,140
    </td>
    
    <td>
      7,986
    </td>
    
    <td>
      5,978
    </td>
  </tr>
  
  <tr>
    <td>
      Combined file
    </td>
    
    <td>
      (5,505)
    </td>
    
    <td class="positive">
      (4,128)
    </td>
    
    <td>
      7,986
    </td>
    
    <td>
      4,423
    </td>
  </tr>
</table>

<ul>
  <li>All numbers are byte sizes<br />
** Numbers in parenthesis represent actual but impractical data. Unfortunately, images cannot be combined and delivered together in their binary form.</li>
</ul>

<p>Takeaways:</p>

<ul>
  <li>The binaries are always smaller.</li>
  <li>Sometimes Gzipping makes the files larger.</li>
  <li>Gzipping the base64 version brings the filesize close to the size of the original binary, but this ignores the fact that the binaries get Gzipped as well. The Gzipped binaries (how they would be delivered to the client) are always smaller than the Gzipped base64 images</li>
  <li>Combining files together dramatically reduces filesizes.</li>
</ul>

<p>Practically, the developer has two options: deliver 5,140 bytes to the user in 5 separate HTTP requests, or 4,423 bytes in one HTTP request (CSS with base64 encoded image data). Base64 is the clear winner here, and seems to confirm that small icons compress extremely well.</p>

<h3 id="test-2-five-flickr-7521575-pictures-jpeg">Test #2: Five Flickr 75×75 Pictures (JPEG)</h3>

<table style="width: 100%;">
  <tr>
    <td>
      File
    </td>
    
    <td>
      Binary
    </td>
    
    <td>
      Binary Gzipped
    </td>
    
    <td>
      CSS + Base64
    </td>
    
    <td>
      CSS + Base64 Gzipped
    </td>
  </tr>
  
  <tr>
    <td>
      <a href="http://www.flickr.com/photos/franksvalli/6064665766/sizes/sq/in/photostream/">1</a>
    </td>
    
    <td>
      6734
    </td>
    
    <td class="positive">
      5557
    </td>
    
    <td>
      9095
    </td>
    
    <td>
      6010
    </td>
  </tr>
  
  <tr>
    <td>
      <a href="http://www.flickr.com/photos/franksvalli/6064638202/sizes/sq/in/photostream/">2</a>
    </td>
    
    <td>
      5379
    </td>
    
    <td class="positive">
      4417
    </td>
    
    <td>
      7287
    </td>
    
    <td>
      4781
    </td>
  </tr>
  
  <tr>
    <td>
      <a href="http://www.flickr.com/photos/franksvalli/6063380824/sizes/sq/in/photostream/">3</a>
    </td>
    
    <td>
      25626
    </td>
    
    <td class="positive">
      18387
    </td>
    
    <td>
      34283
    </td>
    
    <td>
      20103
    </td>
  </tr>
  
  <tr>
    <td>
      <a href="http://www.flickr.com/photos/franksvalli/6062803159/sizes/sq/in/photostream/">4</a>
    </td>
    
    <td>
      7031
    </td>
    
    <td class="positive">
      6399
    </td>
    
    <td>
      9491
    </td>
    
    <td>
      6702
    </td>
  </tr>
  
  <tr>
    <td>
      <a href="http://www.flickr.com/photos/franksvalli/6017796233/sizes/sq/in/photostream/">5</a>
    </td>
    
    <td>
      5847
    </td>
    
    <td class="positive">
      4655
    </td>
    
    <td>
      7911
    </td>
    
    <td>
      5077
    </td>
  </tr>
  
  <tr>
    <td>
      Total
    </td>
    
    <td>
      50,617
    </td>
    
    <td class="positive">
      39,415
    </td>
    
    <td>
      68,067
    </td>
    
    <td>
      42,673
    </td>
  </tr>
  
  <tr>
    <td>
      Combined file
    </td>
    
    <td>
      (50,617)
    </td>
    
    <td class="positive">
      (36,838)
    </td>
    
    <td>
      68,067
    </td>
    
    <td>
      40,312
    </td>
  </tr>
</table>

<p>Takeaways:</p>

<ul>
  <li>(some of the same takeaways as Test #1)</li>
  <li>Separately, photos aren’t too much bigger when base64 encoded and Gzipped. It’s very much within reason.</li>
</ul>

<p>Practically, the developer can deliver 39,415 bytes in 5 separate requests, or 40,312 in 1 request. Not much filesize difference here, but 1 request seems preferable when we’re talking about 40kb.</p>

<h3 id="test-3-five-flickr-240215160-pictures-jpeg">Test #3: Five Flickr 240×160 Pictures (JPEG)</h3>

<table style="width: 100%;">
  <tr>
    <td>
      File
    </td>
    
    <td>
      Binary
    </td>
    
    <td>
      Binary Gzipped
    </td>
    
    <td>
      CSS + Base64
    </td>
    
    <td>
      CSS + Base64 Gzipped
    </td>
  </tr>
  
  <tr>
    <td>
      1
    </td>
    
    <td>
      24502
    </td>
    
    <td class="positive">
      23403
    </td>
    
    <td>
      32789
    </td>
    
    <td>
      23982
    </td>
  </tr>
  
  <tr>
    <td>
      2
    </td>
    
    <td>
      20410
    </td>
    
    <td class="positive">
      19466
    </td>
    
    <td>
      27333
    </td>
    
    <td>
      19954
    </td>
  </tr>
  
  <tr>
    <td>
      3
    </td>
    
    <td>
      43833
    </td>
    
    <td class="positive">
      36729
    </td>
    
    <td>
      58561
    </td>
    
    <td>
      38539
    </td>
  </tr>
  
  <tr>
    <td>
      4
    </td>
    
    <td>
      31776
    </td>
    
    <td class="positive">
      31180
    </td>
    
    <td>
      42485
    </td>
    
    <td>
      31686
    </td>
  </tr>
  
  <tr>
    <td>
      5
    </td>
    
    <td>
      21348
    </td>
    
    <td class="positive">
      20208
    </td>
    
    <td>
      28581
    </td>
    
    <td>
      20761
    </td>
  </tr>
  
  <tr>
    <td>
      Total
    </td>
    
    <td>
      141,869
    </td>
    
    <td class="positive">
      130,986
    </td>
    
    <td>
      189,749
    </td>
    
    <td>
      134,922
    </td>
  </tr>
  
  <tr>
    <td>
      Combined file
    </td>
    
    <td>
      (141,869)
    </td>
    
    <td class="positive">
      (129,307)
    </td>
    
    <td>
      189,749
    </td>
    
    <td>
      133,615
    </td>
  </tr>
</table>

<p>Takeaways:</p>

<ul>
  <li>(some of the same takeaways as Test #1)</li>
  <li>Larger photos seem to bring the Gzipped binary and Gzipped base64 filesizes MUCH closer together, making the difference very minimal</li>
</ul>

<p>The developer must choose between delivering 130,986 bytes in 5 HTTP requests, or 133,615 bytes in one HTTP request. Any good Souders follower would opt for the one request, BUT I would be careful here…</p>

<h4 id="caution-things-aren8217t-always-as-they-seem">Caution: things aren’t always as they seem</h4>

<p>There’s a huge caveat here: it may actually be more beneficial for perceived performance to deliver the images in 5 separate requests.</p>

<p>Why? Because 133,615 bytes is a lot to deliver all in one package to an end user who will be staring at blank placeholders for the duration. If the 5 base64 images all come in one request, that request will have to complete before ANYTHING is shown on the screen. All 5 images go from blank placeholders to almost immediately decoded from base64 and displayed in place.</p>

<p>Compare this with 5 requests that are most likely made in parallel and actually give a visual indicator to the user that actual image content is being downloaded, by showing parts of the images as they’re downloaded (you can also try a throwback to progressive JPEGs – really anything will be better than just a blank screen). That’s why it might actually be beneficial for <em>perceived</em> performance to just load images in the good old fashioned way. They will most likely load in parallel anyway, so the extra HTTP requests may actually not really make a difference. Not to mention it will be easier to let the browser manage the cache for each file instead of having to make your JavaScript manage your cache and prevent you from downloading an image that’s already stored away in localStorage or sessionStorage.</p>

<p>This being said, it’s generally advisable to put your common UI icons in base64 in your CSS, then let that whole chunk get cached by the browser. Those are usually clean vector icons as well, which seem to get compressed quite well (see Test #1).</p>

<p>But for image content, where there is nothing to be saved but HTTP requests, you should definitely think twice about base64 encoding to save requests. Yes, you will save a few HTTP requests, you won’t really be saving bytes, and the user might actually think the experience is slower because they can’t see the image content as it’s being downloaded. Even if you shave off a few milliseconds of wait time, the <em>perceived</em> performance is what matters most.</p>

<p>(EDIT: changed the wording of the “unverified intuitions” section from “not verified” to actual questions, to make it clearer)</p>

<p>EDIT May 2013: added an example of sprite bleedthrough</p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/2011/different-ways-of-defining-functions-in-javascript-this-is-madness">
			
				Different Ways of Defining Functions in JavaScript (This Is Madness!)</a>
		</h2>
		<div class="meta date">








  


<time datetime="2011-06-24T00:00:00-07:00" pubdate data-updated="true">Jun 24<span>th</span>, 2011</time></div>
	</header>
	<div class="entry-content">
		<h3 id="this-is-madness-this8230-is8230-javascript">This is madness! This… is… JavaScript!</h3>

<p>In JavaScript, there’s many different ways of doing something. This is both a good thing and a bad thing. To the newcomer this is definitely a bad thing, as it means not only more things to learn, but more little caveats and more places to go wrong. And so it is with declaring functions!</p>

<p>The aim of this is just an accessible tour of the landscape, just so you know what’s out there and what the basic differences are. Do be sure to check out the “further reading” section as well! Much of this is based on <a href="http://kangax.github.com/nfe/">Juriy “kangax” Zaytsev’s article</a>, which goes into more depth. But I found that there wasn’t just one reference to show all the different variable declarations.</p>

<p>How about ways to execute functions? That opens up another can of worms, and incidentally opens up the possibility for a future post on that topic. :)</p>

<h3 id="overview-different-ways-of-declaring-functions">Overview: different ways of declaring functions</h3>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
</pre></td>
  <td class="code"><pre><span class="keyword">function</span> <span class="function">A</span>(){};             <span class="comment">// function declaration</span>
<span class="keyword">var</span> <span class="function">B</span> = <span class="keyword">function</span>(){};       <span class="comment">// function expression</span>
<span class="keyword">var</span> C = (<span class="keyword">function</span>(){});     <span class="comment">// function expression with grouping operators</span>
<span class="keyword">var</span> <span class="function">D</span> = <span class="keyword">function</span> <span class="function">foo</span>(){};   <span class="comment">// named function expression</span>
<span class="keyword">var</span> E = (<span class="keyword">function</span>(){        <span class="comment">// immediately-invoked function expression (IIFE) that returns a function</span>
  <span class="keyword">return</span> <span class="keyword">function</span>(){}
})();
<span class="keyword">var</span> F = <span class="keyword">new</span> Function();     <span class="comment">// Function constructor</span>
<span class="keyword">var</span> G = <span class="keyword">new</span> <span class="keyword">function</span>(){};   <span class="comment">// special case: object constructor</span>
</pre></td>
</tr></table>
</div>

<h3 id="function-declarations-function-a">Function declarations: function A(){};</h3>

<p>Function declarations are probably the most familiar and oldest way of doing things in JavaScript land. This creates a variable A which is accessible in the current scope. Scope is a separate topic, so well do everything in the global scope for all these examples (something you want to avoid usually).</p>

<h4 id="hoisting">1. Hoisting</h4>

<p>The interesting thing about these is that they are “hoisted” to the top of their scope, which means this code:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
</pre></td>
  <td class="code"><pre>A();
<span class="keyword">function</span> <span class="function">A</span>(){
  console.log(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>);
};
</pre></td>
</tr></table>
</div>

<p>Gets executed as this code:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
</pre></td>
  <td class="code"><pre><span class="keyword">function</span> <span class="function">A</span>(){
  console.log(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>);
};
A();
</pre></td>
</tr></table>
</div>

<p>Which practically means that, yes, you can call the functions before they’re written in your code. It won’t matter, because the entire function gets hoisted to the top of its containing scope. (This is contrasted with variables, which only have their declaration hoisted, not their contents, as we’ll see in the next section).</p>

<h4 id="no-function-declarations-in-if-statements-or-loops-etch4">2. No function declarations in <code>if</code> statements (or loops, etc)&lt;/h4&gt;</h4>
<p>You can’t define functions this way in expressions, for example <code>if</code> statements, which is common if we want to define different versions of a function for different circumstances, usually to address browser inconsistencies. Well, you <em>can</em> in some implementations, but the way the code is processed is inconsistent (kangax has documented the inconsistencies <a href="http://kangax.github.com/nfe/">here</a>). If you want to use this pattern, use function expressions instead.</p>

<h4 id="functions-declarations-must-have-names">3. Functions declarations must have names</h4>

<p>This method doesn’t allow you to create anonymous functions, meaning that you always have to give it an identifier (in this case we’ve used “A”).</p>

<h3 id="function-expressions-var-b--function">Function expressions: var B = function(){};</h3>

<p>A function expression looks similar to function declarations, except that the function is assigned to a variable name. Though functions are not primitive values in JavaScript, this is the way they can be utilized to their full effect in this functional language. Functions are “<a href="http://en.wikipedia.org/wiki/First-class_function">first class</a>”:</p>

<blockquote>
  <p>“[JavaScript] supports passing functions as arguments to other functions, returning them as the values from other functions, and assigning them to variables or storing them in data structures”</p>
</blockquote>

<h4 id="anonymous-functions-they-dont-need-names">1. Anonymous functions (they don’t need names)</h4>

<p>The function name is optional in function expressions, and we call these anonymous. Here we’re setting the variable B equal to an anonymous function:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> <span class="function">B</span> = <span class="keyword">function</span>(){};
</pre></td>
</tr></table>
</div>

<h4 id="variable-declaration-hoisting">2. Variable declaration hoisting</h4>

<p>Variable declarations are hoisted to the top of their scope, somewhat similarly to function hoisting <em>except</em> the contents of the variable are not hoisted as well. This happens with all variables, and it means it’s now happening with our functions, now that we’re assigning them to variables.</p>

<p>This code:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> <span class="function">A</span> = <span class="keyword">function</span>(){};
<span class="keyword">var</span> <span class="function">B</span> = <span class="keyword">function</span>(){};
<span class="keyword">var</span> <span class="function">C</span> = <span class="keyword">function</span>(){};
</pre></td>
</tr></table>
</div>

<p>Will be executed as this:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> A, B, C;  <span class="comment">// variable declarations are hoisted</span>
<span class="function">A</span> = <span class="keyword">function</span>(){};
<span class="function">B</span> = <span class="keyword">function</span>(){};
<span class="function">C</span> = <span class="keyword">function</span>(){};
</pre></td>
</tr></table>
</div>

<p>Therefore the order of setting and calling this type of function is important:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
</pre></td>
  <td class="code"><pre><span class="comment">// this works</span>
<span class="keyword">var</span> <span class="function">B</span> = <span class="keyword">function</span>(){};
B();

<span class="comment">// this doesn't work</span>
B2();  <span class="comment">// TypeError (B2 is undefined)</span>
<span class="keyword">var</span> <span class="function">B2</span> = <span class="keyword">function</span>(){};
</pre></td>
</tr></table>
</div>

<p>The second example gives us an error because only the variable B2’s declaration is hoisted, but not its definition, thus the “undefined” error.</p>

<h3 id="function-expressions-with-grouping-operators-var-c--function">Function expressions with grouping operators: var C = (function(){});</h3>

<p>These really aren’t different from plain old function expressions and aren’t really seen in the wild (so maybe they’re just good for JavaScript quizzes?). Recently this way of declaring functions was brought up in <a href="http://ironjs.wordpress.com/2011/06/22/my-gripes-with-javascript/">this article</a> and confused some folks including myself.</p>

<p>Here’s a good way to see what’s happening:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
</pre></td>
  <td class="code"><pre><span class="keyword">function</span>(){};  <span class="comment">// SyntaxError</span>
(<span class="keyword">function</span>(){});
</pre></td>
</tr></table>
</div>

<p>Why does one work and the other doesn’t? The first example is a function declaration, and we learned above that we can’t declare them anonymously - that is, they must have a name. That’s why we’re getting the syntax error.</p>

<p>The second example is using parenthesis - grouping operators - and is therefore evaluated differently, as a function expression. The grouping operators are the things we use to help show what should be evaluated first, as in mathematical problems. We’re saying “evaluate this first, then take the result and do something with it”:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
</pre></td>
  <td class="code"><pre>(<span class="integer">1</span> + <span class="integer">2</span>) * <span class="integer">3</span>;  <span class="comment">// 9</span>
<span class="integer">1</span> + (<span class="integer">2</span> * <span class="integer">3</span>);  <span class="comment">// 7</span>
</pre></td>
</tr></table>
</div>

<p>In the first example we’re saying “first add 1 and 2, then take the result and multiply by 3”, whereas in the second example we’re saying “first multiply 2 and 3, then take the result and add 1”.</p>

<p>Because functions are first class, we can use similar grouping operators. Here’s a facetious example, but it shows how we can essentially drop in a function in the same way:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
</pre></td>
  <td class="code"><pre>(<span class="keyword">function</span>(){} + <span class="integer">1</span>);  <span class="comment">// function(){}1</span>
</pre></td>
</tr></table>
</div>

<p>The result is a string (because toString is being called on the function, then added/appended with 1), but you get the idea I hope.</p>

<p>When the JavaScript engine encounters the opening parenthesis here, we’re essentially saying “ok, start grouping this together with something else”. Using our technical terms, we’re telling the engine that we’re not making a function declaration, but instead a function expression. And then we can assign the result to a variable:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
</pre></td>
  <td class="code"><pre>(<span class="keyword">function</span>(){});           <span class="comment">// resulting function not assigned</span>
<span class="keyword">var</span> foo = (<span class="keyword">function</span>(){}); <span class="comment">// resulting function assigned to foo</span>
<span class="keyword">var</span> <span class="function">bar</span> = <span class="keyword">function</span>(){};   <span class="comment">// resulting function assigned to bar</span>
</pre></td>
</tr></table>
</div>

<p>Here we can see that foo and bar are really just the same, because in foo we’re not grouping the function together with anything but itself.</p>

<h3 id="named-function-expression-var-d--function-foo">Named function expression: var D = function foo(){};</h3>

<p>Here we have our same old friend, the function expression. But instead of assigning the variable to an anonymous function, we’re assigning it to a named function (with the name foo).</p>

<h4 id="the-function-name-is-only-accessible-within-the-function">1. The function name is only accessible within the function</h4>

<p>We haven’t exposed the function name (foo) to the enclosing scope (in this case the global scope):</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> <span class="function">D</span> = <span class="keyword">function</span> <span class="function">foo</span>(){
  console.log(<span class="keyword">typeof</span> foo);
};
D();                       <span class="comment">// function</span>
console.log(<span class="keyword">typeof</span> foo);   <span class="comment">// undefined</span>
</pre></td>
</tr></table>
</div>

<h4 id="useful-for-recursion">2. Useful for recursion</h4>

<p>Because the function’s name is accessible in the function itself, this turns out to be useful for recursive functions, much more useful than the plain old anonymous function.</p>

<p>Here’s a trivial recursive function to illustrate calling itself from within the named function expression:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> <span class="function">countdown</span> = <span class="keyword">function</span> <span class="function">a</span>(count){
  <span class="keyword">if</span>(count &gt; <span class="integer">0</span>) {
    count--;
    <span class="keyword">return</span> a(count);  <span class="comment">// we can also do this: a(--count), which is less clear</span>
  }
  console.log(<span class="string"><span class="delimiter">'</span><span class="content">end of recursive function</span><span class="delimiter">'</span></span>);
}
countdown(<span class="integer">5</span>);
</pre></td>
</tr></table>
</div>

<h4 id="useful-for-debugging">3. Useful for debugging</h4>

<p>As a <a href="http://kangax.github.com/nfe/">few</a> <a href="http://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/">have</a> pointed out, giving previously anonymous functions names helps in debugging, since the function name shows up on the call stack.</p>

<h4 id="quirks-jscripts-bad-implementation">4. Quirks: JScript’s bad implementation</h4>

<p><a href="http://kangax.github.com/nfe/">kangax</a> points out that named function expressions are basically poison to JScript, Internet Explorer’s implementation of JavaScript.</p>

<p>The named function becomes a global variable, is hoisted like a function declaration, and actually ends up creating multiple instances of the same function.</p>

<h3 id="immediately-invoked-function-expressions-iife-var-e--functionreturn-function">Immediately-invoked function expressions (IIFE): var E = (function(){return function(){}})();</h3>

<p>“Execute this function, whose return value is another function, and assign that to the variable E”. This may seem like magic, but it’s actually quite simple, and the pattern is powerful and has useful applications, the most famous of which is the <a href="http://www.klauskomenda.com/code/javascript-programming-patterns/#module">module pattern</a>.</p>

<p>First we’ll use an example that doesn’t look like magic:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> <span class="function">foo</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="string"><span class="delimiter">'</span><span class="content">bar</span><span class="delimiter">'</span></span>;
};
<span class="keyword">var</span> output = foo();
console.log(output);  <span class="comment">// 'bar'</span>
</pre></td>
</tr></table>
</div>

<p>We already learned about grouping operators above, so you should feel comfortable with saying this is equivalent:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> <span class="function">foo</span> = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="string"><span class="delimiter">'</span><span class="content">bar</span><span class="delimiter">'</span></span>;
};
<span class="keyword">var</span> output = (foo)(); <span class="comment">// note the extra grouping operators</span>
console.log(output);  <span class="comment">// 'bar'</span>
</pre></td>
</tr></table>
</div>

<p>Since foo is pointing to our function expression, we know that we can simply refrain from using the variable “foo” and drop in the entire function as an anonymous function (since functions are first class, after all!):</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> output = (<span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="string"><span class="delimiter">'</span><span class="content">bar</span><span class="delimiter">'</span></span>;
})();
console.log(output);  <span class="comment">// 'bar'</span>
</pre></td>
</tr></table>
</div>

<p>Hey wait, we just arrived at the magical resulting function! It turns out to be not so magical after all, once we break it down and see it for what it is. It’s simply shorthand for the code we wrote originally, where we defined a function, executed it, and defined output to be its return value.</p>

<p>I’ve included this method on the list of declaring functions because we can assign the return value to itself be a function:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> E = (<span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="keyword">function</span>(){}
})();
</pre></td>
</tr></table>
</div>

<h4 id="applications">Applications</h4>

<p>There are good applications for this, including information hiding using in the module pattern, (<a href="http://ejohn.org/blog/partial-functions-in-javascript/">partial application</a>, for example), and other clever uses of it. It’s definitely not a trivial pattern.</p>

<h3 id="function-constructor-var-f--new-function">Function constructor: var F = new Function();</h3>

<p>This method is extremely old and it’s not recommended to be used. You pass in an unlimited number of arguments in the front, then the actual function body appears as a string in the last argument (because it’s a string, it’s effectively the equivalent of eval(), and isn’t recommended).</p>

<h4 id="defining-the-function">1. Defining the function</h4>

<p>You can create a function like this:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> F = <span class="keyword">new</span> Function(<span class="string"><span class="delimiter">'</span><span class="content">arg1</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">arg2</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">console.log(arg1 + &quot;, &quot; + arg2)</span><span class="delimiter">'</span></span>);
F(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">bar</span><span class="delimiter">'</span></span>);  <span class="comment">// 'foo, bar'</span>
</pre></td>
</tr></table>
</div>

<h4 id="you-dont-need-the-new-operatorh4">2. You don’t need the <code>new</code> operator&lt;/h4&gt;</h4>
<p>You can simply write <code>var F = Function();</code> to get the same result.</p>

<h4 id="quirks">3. Quirks</h4>

<p>The <a href="https://developer.mozilla.org/en/JavaScript/Reference/Functions_and_function_scope#Function_constructor_vs._function_declaration_vs._function_expression">MDN docs</a> have some good examples of the quirks, including the fact that functions declared with the Function constructor don’t inherit their current scope properly (i.e. a closure isn’t formed).</p>

<p>What this means is that they don’t have access to variables in their enclosing scope, which isn’t particularly useful:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
<strong><a href="#n10" name="n10">10</a></strong>
<a href="#n11" name="n11">11</a>
<a href="#n12" name="n12">12</a>
</pre></td>
  <td class="code"><pre><span class="keyword">function</span> <span class="function">foo</span>(){
  <span class="keyword">var</span> bar = <span class="string"><span class="delimiter">'</span><span class="content">blah</span><span class="delimiter">'</span></span>;
  
  <span class="keyword">var</span> first = <span class="keyword">new</span> Function(<span class="string"><span class="delimiter">'</span><span class="content">console.log(typeof bar)</span><span class="delimiter">'</span></span>);
  first();   <span class="comment">// undefined</span>
  
  <span class="keyword">var</span> <span class="function">second</span> = <span class="keyword">function</span>(){
    console.log(<span class="keyword">typeof</span> bar);
  }
  second();  <span class="comment">// string</span>
}
foo();
</pre></td>
</tr></table>
</div>

<p>In the function “first”, we’re using the Function constructor, so it doesn’t have access to the variable bar. However, if we use the function “second”, which is a function expression, it does in fact have access to variables defined in its enclosing scope (via closure).</p>

<p>In other words, <em>don’t use the Function constructor</em>.</p>

<h3 id="special-case---object-constructor-var-g--new-function-foo">Special case - object constructor: var G = new function foo(){};</h3>

<p>I saved this for last because we’re not really defining a function, though we are using the function keyword, so it’s worth noting at least.</p>

<p><code>new function(){};</code> creates a new object and invokes the anonymous function as its constructor. If an object is returned from the function, that becomes the resulting object, otherwise a new object is created from scratch and function is executed in the context of that new function (let’s save the details for another post!).</p>

<p>It’s a bit unusual to see it in this form. Let’s do it the proper way:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> <span class="function">Person</span> = <span class="keyword">function</span>(){
  console.log(<span class="local-variable">this</span>);  <span class="comment">// Person</span>
}
<span class="keyword">var</span> joe = <span class="keyword">new</span> Person();
</pre></td>
</tr></table>
</div>

<p>So really with the new operator, we are giving it a new ‘this’ context and then executing the given function with that new context. Much different than the function definitions we’ve been dealing with above! This does into a whole new topic, and we’ll save that for later!</p>

<h3 id="further-reading">Further reading</h3>

<p><a href="http://kangax.github.com/nfe/">Named function expressions demystified</a> (kangax)</p>

<p><a href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/">Immediately-Invoked Function Expression (IIFE) (Ben Alman)</a></p>

<p><a href="https://developer.mozilla.org/en/JavaScript/Reference/Functions_and_function_scope">Functions and function scope</a> (Mozilla Developer Network - MDN)</p>

<p><a href="http://stackoverflow.com/questions/1140089/how-does-an-anonymous-function-in-javascript-work">How does an anonymous function in JavaScript work? (StackOverflow)</a></p>

<p><a href="http://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/">Function Declarations vs. Function Expressions (JavaScript, JavaScript by Angus Croll)</a></p>

<p><a href="http://www.amazon.com/gp/product/0596805527/">JavaScript: The Definitive Guide</a> (classic book by David Flanagan)</p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/2011/on-professional-self-worth">
			
				On Professional Self-worth</a>
		</h2>
		<div class="meta date">








  


<time datetime="2011-06-21T00:00:00-07:00" pubdate data-updated="true">Jun 21<span>st</span>, 2011</time></div>
	</header>
	<div class="entry-content">
		<p>Huge huge rant incoming, but all is not said and done, and much is open for debate of course. Counterpoints and criticisms are more than welcome in the comments. This is just my opinion based on my experience at this point in time.</p>

<h3 id="self-worth-the-rich-man-and-the-poor-man">Self-worth: the rich man and the poor man</h3>

<p>For a long while there have been places in the world that view self-worth as largely tied to wealth.  No doubt there is more than just money, as even within the rich community there’s a distinction between the established rich and the “nouveau riche”, or the newly rich.  One is ranked higher than the other, but nonetheless the rich are themselves seen as being more important than the average person.</p>

<p>You might not believe me.  That means it’s time for a thought experiment!</p>

<p>One way to hammer home this point is to posit a classic thought experiment.  There are two people – one rich and one poor – and this is all the information we have about them (this is important).  Assuming that one of them will die in some horrific way and we can only choose to save one, most people would probably save the rich person (assuming they don’t have a bias or some psychological complex against rich folks).  Remember, we have no other information about them other than one is rich and one is poor.  The aim of the thought experiment, rather than trying to give a realistic scenario, is to simply try to show us that we give the rich person preference.  At least ij the case where we have no other information.</p>

<p>And it’s not even that we think we might receive a reward from the rich person!  Even if we figure that in, we still give preference to the rich person, probably in part because we think that they must be somewhat more important than the poor person.  They must have acquired that money some way, after all.  Possobly even through hard work.  The poor person, we assume, must be poor for a reason, and that might be through sheer laziness.  So we have a hard worker versus a lazy worker… which one is more worthy to live?  And it’s only those hasty assumptions that we have to deal with.</p>

<h3 id="professional-worth-employees-of-famous-and-nonfamous-companies">Professional worth: employees of famous and nonfamous companies</h3>

<p>Laying aside issues of money for a moment, let’s perform a similar thought experiment, except with different people.  One person works at company X, which no one has really heard of, and the other person works at company Y, which at the time is a wildly famous and reputable company.  Because this industry is so fickle and subject to change, at the time of this writing this famous company might be Facebook, Google, or Twitter.  Or any other company which has the tech zeitgeist or mojo at the time.</p>

<p>Assuming we know nothing else but the people’s employers (and laying aside biases and hatred for certain companies), if we put these people on the line, the one employee of a no-name company and the other employee of a famous company, we would probably choose to save the latter.  For much of the same reasons as above.  For instance, this person got a job at Facebook, so they must be smart and a hard worker.  On the other hand, the person at the no-name company (i.e. the vast majority of people out there) is probably not as smart or not as hard-working.  After all, if they were, then they would’ve been at (famous company) by now!  Therefore they are undoubtedly less worthy professionally, and by hasty extension, less worthy as a human being (remember, we have no other information to base our conclusion off of).</p>

<p>So it is!  Death to the employee of the nonfamous company!</p>

<h3 id="work-history-first-impressions-and-professional-self-worth">Work history, first impressions, and professional self-worth</h3>

<p>We chose to save the rich person and the Facebook engineer. The good thing is that luckily almost no one thinks in these horrible black-and-white terms, and we always take into account other available factors.  For instance, as an example of a poor person we might have Mother Teresa and as a rich person we might have mean old Donald Trump.  No one in their right mind would send Mother Teresa off to the gallows while letting Trump off (regardless of what you think of Trump really).</p>

<p>The problem here is that although we do take into account different factors, professionally we (and recruiters) weigh our work history much too heavily in the grand scheme of things.  We take other factors into consideration, sure, but work history is a huge deciding factor as far as people are paid attention to, give off good first impressions, or are even given a single glance by recruiters.</p>

<p>This isn’t totally unwarranted, I should say.  Chances are, if someone worked at a few famous companies, there’s a good chance they are a better than average engineer, even though there’s no guarantee of this (there are always exceptions).  But that’s not the problem here.  The problem is because this is given a disproportionate amount of weight, people start to view this as THE deciding factor in whether to work for a company.  Name-brand recognition becomes a goal-in-itself.  Money always matters, sure, but professionally there is little that can beat having a reputable name brand on a resume.</p>

<p>So what happens in practice?  An engineer becomes employed at a famous big company, is put to work maintaining some existing platforms, and at the end of a year perhaps learns some things that make them a better engineer.  But the same person instead working for some no-name startup might in the same period of time learn many more technologies, solve many more problems, and have a bit more freedom and opportunity to create (though they won’t necessarily learn best practices or scaling issues that typically come with famous large companies, but there’s more to being a good engineer than that!).  Each gets an opportunity to get their hands dirty with different varieties of dirt.  At the end of the day, I would say the latter very well becomes a more well-rounded engineer, instead of a generic single-functioned cog in some big company machine.</p>

<p>Ok, now my bias is showing through brilliantly!</p>

<p>Let’s at least say, for the purposes of argument, that both engineers are equally skilled (though this is hard to quantify, though, obviously).  So who do the recruiters contact, the employee at the famous company or the employee at the nonfamous company?  Who gets more attention from people in general when they’re asked where they work?  In short, whose professional life is a priori more highly valued?  You already know the answer.</p>

<h3 id="final-thoughts">Final thoughts</h3>

<p>We MUST become more confident of our skills (I need to work on this myself), and we must be tough enough and realistic enough to know our own professional worth.  Appearances count for much in this world, and too much at that.  But what better to maintain if we are authentic human beings: an appearance or something deeper?</p>

<p>Famous companies do look good on resumes in the same way Ivy Leagues colleges look good on the very same piece of paper.  But don’t make this a deciding factor when choosing an employer.  It’s true that it will help you find more jobs and get more respect in the long run, but then you are wasting your time doing something you don’t want to do for the duration, for a company that exists for its own ends, not the ends of its employees (this is true of most companies out there, to be fair).  If you are ok wasting your time for a cause such as this, then go for it. It seems some people are ok with that.  At the very least be aware of it.</p>

<p>So what happens to the passionate engineers who actually do want to work for a famous company for reasons other than brand recognition?  They might not always get the job.  But it’s definitely not the end of the world.  No one should be disheartened because Google turned them away for not being able to answer today’s technological equivalent of “how many angels can dance on the head of a pin” (or other mental masturbation puzzles).  In the end it’s you that makes you a worthy professional and a good engineer.  If your job doesn’t actually give you a chance to be one, you can still become one on your own.  I would say most people are capable of this if they invest the effort.</p>

<p>But working for a famous company, and for its own sake?  It doesn’t necessarily make you a good engineer, any more than wearing glasses and dressing in a suit gives more validity to your opinions (even though many people sadly tend to think otherwise).</p>

<p>(Note to self: I wrote this on the banks of the Kamogawa River in Kyoto on my iPad. I was enjoying the moment and obviously in a contemplative mood!)</p>

		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/2011/new-mobile-safari-stuff-in-ios5-position-fixed-overflow-scroll-new-input-type-support-web-workers-ecmascript-5">
			
				New Mobile Safari Stuff in iOS5: Position:fixed, Overflow:scroll, New Input Type Support, Web Workers, ECMAScript 5</a>
		</h2>
		<div class="meta date">








  


<time datetime="2011-06-07T00:00:00-07:00" pubdate data-updated="true">Jun 7<span>th</span>, 2011</time></div>
	</header>
	<div class="entry-content">
		<p>(note: this is based on the first iOS5 beta [9A5220p] and is subject to change on final release)</p>

<p>It looks like there’s finally some major improvements in mobile Safari, some of which I’ve found below on my “first glance” after downloading the SDK. Chime in if you find anything yourself!</p>

<h3 id="bad-news-first">Bad news first</h3>

<p>Much to my disappointment, browser-based file uploads are still not supported (<a href="http://frontendstuff.com/html/examples/input-type-file.html">input type=”file”</a>), even though they have been supported on Android since version 2.2 (which they have <a href="http://davidbcalhoun.com/2011/android-3-0-honeycomb-is-first-to-implement-the-device-api">continued to improve and refine</a>). The best use case for this is uploading pictures and videos straight from the browser, but Apple seems more interested in making those functions possible directly from the operating system itself, supporting only big names like Twitter and YouTube. So much for the little guys.</p>

<p>There’s other stuff on my wishlist that hasn’t yet been implemented, such as <s>WebGL and</s> indexedDB, along with some HTML5 input types, but regardless it’s good to see some real progress in iOS 5. (update: it appears that some WebGL features are starting to be supported, although the demos I tried didn’t seem to work).</p>

<p>Now let’s move on to the awesome new stuff that IS implemented!</p>

<h3 id="positionfixed">position:fixed</h3>

<p>A point of contention since the original iPhone was released in 2007, position:fixed now works on iOS5! What this means to developers: it’s now very easy to create top and bottom toolbars for your web apps. (there’s a long history of hacks and workarounds which will still need to be implemented as a fallback for the time being, but I’ll save that for another post. I should also mention that position:fixed has worked on Android since version 2.2, and webOS seems to support a somewhat hacky implementation).</p>

<p>Here’s a <a href="http://www.youtube.com/watch?v=JFzv3ETwfms">video demo of position:fixed on iOS5</a>:</p>

<p>(check out the <a href="http://frontendstuff.com/css/examples/position-fixed.html">demo</a> for yourself)</p>

<h3 id="overflowscroll">overflow:scroll</h3>

<p>This is a similar problem to position:fixed, but now it works on iOS5! For content that doesn’t fit in its container element, previously the content was completely cut off (similarly with iframes). On the desktop we have the option to show scrollbars instead, allowing the user to scroll to see the content, but iOS made this difficult by requiring two fingers to scroll. Now overflow:scroll works and the user can scroll through the container’s content with a single finger. Developers can use new CSS to enable native scrolling (with scrollbars and momentum):</p>

<div class="codecolorer-container text twitlight" style="overflow:auto;white-space:nowrap;width:435px;">
  <table cellspacing="0" cellpadding="0">
    <tr>
      <td class="line-numbers">
        <div>
          1<br />
        </div>
      </td>
      
      <td>
        <div class="text codecolorer">
          -webkit-overflow-scrolling: touch;
        </div>
      </td>
    </tr>
  </table>
</div>

<p>(via <a href="http://johanbrook.com/browsers/native-momentum-scrolling-ios-5/">Johan Brook</a>).</p>

<p>It’s assumed that it’s up to the developer to implement some sort of visual indicator to let the user know they can interact with the element.</p>

<p>One criticism so far: there’s no inertia scroll on this element, so it doesn’t quite feel the same as scrolling the page.</p>

<p>Here’s a quick <a href="http://www.youtube.com/watch?v=KwpZ1F6dW5U">video demo of overflow:scroll on iOS 5</a>.</p>

<p>(check out the <a href="http://frontendstuff.com/css/examples/overflow-scroll.html">demo</a> for yourself)</p>

<h3 id="new-input-types">New Input Types</h3>

<p>HTML5 defined many new helpful input types, and mobile operating systems have been slowly implementing them and creating optimized keyboards for the inputs. iOS5 now supports these input types: date, datetime, month, time, range. Click on the images to see their respective demo pages:</p>

<p><a href="http://frontendstuff.com/html/input-type-date.html"><img src="http://davidbcalhoun.com/wp-content/uploads/2011/06/ios-date-input.png" alt="iOS Date Input" title="iOS Date Input" width="320" height="480" class="size-full wp-image-677" /></a><a href="http://frontendstuff.com/html/input-type-datetime.html"><img src="http://davidbcalhoun.com/wp-content/uploads/2011/06/ios-datetime-input.png" alt="iOS Datetime Input" title="iOS Datetime Input" width="320" height="480" class="size-full wp-image-678" /></a><a href="http://frontendstuff.com/html/input-type-month.html"><img src="http://davidbcalhoun.com/wp-content/uploads/2011/06/ios-month-input.png" alt="iOS Month Input" title="iOS Month Input" width="320" height="480" class="size-full wp-image-680" /></a><a href="http://frontendstuff.com/html/input-type-time.html"><img src="http://davidbcalhoun.com/wp-content/uploads/2011/06/ios-time-input.png" alt="iOS Time Input" title="iOS Time Input" width="320" height="480" class="size-full wp-image-682" /></a><a href="http://frontendstuff.com/html/input-type-range.html"><img src="http://davidbcalhoun.com/wp-content/uploads/2011/06/ios-range-input.png" alt="iOS Range Input" title="iOS Range Input" width="320" height="480" class="size-full wp-image-681" /></a></p>

<p>And a fun one – <a href="http://davidbcalhoun.com/2011/implementing-iphone-slider-unlock-with-input-type-range">my iPhone slider hack based on input type range</a>, which now actually works on the iPhone itself (because input type=”range” is now supported)!</p>

<p><a href="http://davidbcalhoun.com/a/iphone-slider.html"><img src="http://davidbcalhoun.com/wp-content/uploads/2011/06/ios-iphone-slider-in-html.png" alt="iOS Slider implemented with Range Input" title="iOS Slider implemented with Range Input" width="320" height="480" class="aligncenter size-full wp-image-679" /></a></p>

<h3 id="web-workers-javascript">Web Workers (JavaScript)</h3>

<p>JavaScript is single-threaded, and it happens to run on the same thread as the UI, which means computationally expensive operations can lead to an unresponsive UI, and no one likes that. Web Workers help by offloading tasks to another thread and only returning output when it needs to. In other words, it’s a good thing for us web developers.</p>

<p>According to my own tests, Web Workers seemed to be briefly enabled on early versions of iOS3, but were soon disabled thereafter. Now with iOS5, they’re back again!</p>

<h3 id="new-ecmascript-5-stuff-javascript">New ECMAScript 5 stuff (JavaScript)</h3>

<p>(based on <a href="http://kangax.github.com/es5-compat-table/">kangax’s ECMAScript 5 compatibility table</a>)</p>

<table>
  <tr>
    <td>
      Feature
    </td>
    
    <td>
      iOS 4.3.2
    </td>
    
    <td>
      iOS 5 beta 1
    </td>
  </tr>
  
  <tr>
    <td>
      Object.create
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Object.defineProperty
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Object.defineProperties
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Object.getPrototypeOf
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Object.keys
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Object.seal
    </td>
    
    <td class="negative">
      No
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Object.freeze
    </td>
    
    <td class="negative">
      No
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Object.preventExtensions
    </td>
    
    <td class="negative">
      No
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Object.isSealed
    </td>
    
    <td class="negative">
      No
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Object.isFrozen
    </td>
    
    <td class="negative">
      No
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Object.isExtensible
    </td>
    
    <td class="negative">
      No
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Object.getOwnPropertyDescriptor
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Object.getOwnPropertyNames
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Date.prototype.toISOString
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Date.prototype.toISOString
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Date.prototype.toISOString
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Date.now
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      JSON
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Function.prototype.bind
    </td>
    
    <td class="negative">
      No
    </td>
    
    <td class="negative">
      No
    </td>
  </tr>
  
  <tr>
    <td>
      String.prototype.trim
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Array.prototype.indexOf
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Array.prototype.lastIndexOf
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Array.prototype.every
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Array.prototype.some
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Array.prototype.forEach
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Array.prototype.map
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Array.prototype.filter
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Array.prototype.reduce
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Array.prototype.reduceRight
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Getter in property initializer
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Setter in property initializer
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Property access on strings
    </td>
    
    <td class="positive">
      Yes
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Reserved words as property names
    </td>
    
    <td class="negative">
      No
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Strict mode
    </td>
    
    <td class="negative">
      No
    </td>
    
    <td class="positive">
      Yes
    </td>
  </tr>
</table>

<h3 id="html5test-score">HTML5Test score</h3>

<p>iOS 4.3.2 scores 206 (7 bonus points) on the <a href="http://html5test.com/">HTML5 Test</a>, whereas iOS 5 beta scores 267 (9 bonus points). Much of these gains seem to be made in the “Forms” and “Parsing rules” sections, as well as the “Web Workers” section.</p>

<h3 id="miscellaneous-new-stuff">Miscellaneous new stuff</h3>

<ul>
  <li>Inline SVG in text/html</li>
  <li>float32array, int8array, int16array, int32array in JavaScript</li>
  <li>window.matchmedia() (JavaScript)</li>
  <li>
    <s>onsearch Event (JavaScript)</s>
    <p>– it looks like this was just broken in later iOS 4.3 builds, but it’s back now in iOS 5</p>
  </li>
  <li>MathML elements recognized (based on <a href="http://html5test.com/">html5test</a>)</li>
  <li>Improved speed of Canvas rendering (<a href="https://twitter.com/#!/KesieV/status/78067470501543936">source</a>)</li>
  <li>UIWebView and home screen web apps now running on Nitro? (expected but not tested)</li>
  <li>Newly supported CSS gradient syntax (-webkit-linear-gradient versus the older -webkit-gradient syntax)</li>
  <li><a href="https://developer.mozilla.org/en/DOM/element.classList">classList</a> (JavaScript)</li>
  <li>A major WebKit HTML5 History (popstate) bug is <a href="https://bugs.webkit.org/show_bug.cgi?id=42940">now fixed</a></li>
  <li><a href="http://html5demos.com/contenteditable">contentEditable</a> now works properly</li>
</ul>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/2011/the-incredibly-painful-way-of-getting-an-rss-feed-of-a-twitter-list">
			
				The Incredibly Painful Way of Getting an RSS Feed of a Twitter List</a>
		</h2>
		<div class="meta date">








  


<time datetime="2011-06-05T00:00:00-07:00" pubdate data-updated="true">Jun 5<span>th</span>, 2011</time></div>
	</header>
	<div class="entry-content">
		<p>(why does Twitter make it so hard? What did RSS ever do to it?)</p>

<h3 id="the-skinny">The skinny</h3>

<p>The Twitter API appears to support two methods for getting RSS feeds of lists. Both of these methods are pretty buried and their API docs don’t help too much, but nonetheless both of these feeds work:</p>

<blockquote>
  <p><a href="http://api.twitter.com/1/nathansmith/lists/javascript/statuses.atom">http://api.twitter.com/1/nathansmith/lists/javascript/statuses.atom</a></p>
</blockquote>

<p>If you have the list ID (requires using some dev tools – see below), you can also use this format:</p>

<blockquote>
  <p><a href="http://api.twitter.com/1/lists/statuses.atom?list_id=41981352">http://api.twitter.com/1/lists/statuses.atom?list_id=41981352</a></p>
</blockquote>

<h3 id="the-explanation">The explanation</h3>

<p>As it turns out, getting an RSS feed of a Twitter list is no easy task, at least from what I’ve found. Twitter has largely replaced RSS for me, in terms of getting the latest and greatest information, and maybe Twitter wants to keep it that way by having me rely on their service instead of an RSS feed. That’s how it seems to me anyway (this is also evidenced by their <a href="https://support.twitter.com/groups/31-twitter-basics/topics/111-features/articles/15361-how-to-find-your-rss-feed">killing off of making RSS feeds easily discoverable</a> but still making the feed available as long as you can figure out your Twitter user id (which is a task in itself), for instance here’s my RSS feed: <a href="https://twitter.com/statuses/user_timeline/16521889.rss">https://twitter.com/statuses/user_timeline/16521889.rss</a>). I’d say this is simply a conspiracy against RSS feeds and developers in general, which is the direction Twitter is headed these days.</p>

<p>In any case, I digress! I want to get an RSS feed of a Twitter list. Great! All I should have to do is go to the page of the list and subscribe to the RSS feed. But.. there’s no RSS feed. Hmm.</p>

<h3 id="google-is-your-friend8230-most-of-the-time">Google is your friend… most of the time</h3>

<p>A search for “twitter list rss” comes up with links to implementing an RSS feed via Yahoo Pipes as well as pages referring to an appspot service that now 404s (<a href="http://twiterlist2rss.appspot.com/">twiterlist2rss</a>). In any case, they are both not what I’m looking for. Which means I have to get creative. Which means… my options at this point are screen scraping (made harder by the fact that Twitter content is now served with JavaScript) or.. gasp.. using their API!</p>

<h3 id="twitter-rest-api-to-the-rescue">Twitter REST API to the rescue</h3>

<p>After digging through the API docs, I found just the page I was looking for, <a href="http://dev.twitter.com/doc/get/lists/statuses">detailing the REST service for Twitter lists</a>.</p>

<p>As it turns out, the basic structure for requesting list data is as follows:</p>

<blockquote>
  <p>http://api.twitter.com/version/lists/statuses.format</p>
</blockquote>

<p>As a newbie Twitter developer, there were a couple of things wrong here. First, what’s the version of the API I’m supposed to use? From other examples on the web (outside of the documentation…) I just assumed I’d be using version 1, and that seemed to work. Ok, whatever, we’ll go with 1:</p>

<blockquote>
  <p>http://api.twitter.com/1/lists/statuses.format</p>
</blockquote>

<p>Second step: this API is actually quite nice, and will return data in three different formats: xml, json, or atom (RSS!). Ok, now we’re making progress!</p>

<blockquote>
  <p>http://api.twitter.com/1/lists/statuses.atom</p>
</blockquote>

<h3 id="where8217s-this-listid-you-speak-of">Where’s this list_id you speak of?</h3>

<p>Now to pass in the info – I need to pass in the list ID in a key called “list_id”. The only problem is… where do I find the list ID? For the purposes of this example I’ll use <a href="https://twitter.com/#!/nathansmith/javascript">Nathan Smith’s excellent JavaScript developers list</a>. To normal human beings, this list might be called “nathansmith/javascript”, but a Twitter ID is numerical, so that’s not what we’re looking for.</p>

<p>So.. I assume at this point I can use some of the Twitter developer tools and fiddle around with them until I find an API call that will translate the human-readable list name into a numerical ID. But no.. I don’t want to download anything, I don’t want to investigate more of the API or go down any more rabbit holes.</p>

<p>It’s time to cut this rabbit hole short and do a bit of investigating. So I pulled up the list, opened up Web Inspector in Chrome, and took a look at the Network tab in the hopes of seeing an API call with an ID I was looking for…</p>

<p>…And I found it! Somewhere down the line, Twitter was calling statuses.json with this request:</p>

<blockquote>
  <p>https://api.twitter.com/1/lists/statuses.json?list_id=41981352&#038;include_entities=1&#038;include_available_features=1&#038;contributor_details=true</p>
</blockquote>

<p>There’s our list_id (and incidentally, the same API call [with json instead of atom].. which shows that Web Inspector is more useful than API docs sometimes)! After a short copy-paste, all the pieces of my Frankenstein API call have been put together:</p>

<blockquote>
  <p><a href="http://api.twitter.com/1/lists/statuses.atom?list_id=41981352">http://api.twitter.com/1/lists/statuses.atom?list_id=41981352</a></p>
</blockquote>

<p>And it works, without having to mess around with OAuth or authentication, registering an app, or whatever. Of course now we can refer back to the API docs and mess around with some parameters to get just the data I’m looking for. Maybe most useful to developers is the handy ability to get easily paginated results:</p>

<blockquote>
  <p><a href="http://api.twitter.com/1/lists/statuses.atom?list_id=41981352&#038;page=2">http://api.twitter.com/1/lists/statuses.atom?list_id=41981352&#038;page=2</a></p>
</blockquote>

<p>There’s also what would be a handy “count” variable, but it’s altogether useless as it appears to be ignored. The API always returned 20 results for me.</p>

<p>In any case, there you have it! The incredibly roundabout way to get an RSS feed of your favorite Twitter list.</p>

<h3 id="update"><strong>UPDATE</strong></h3>

<p>Thanks to <a href="http://sociable.co/2011/05/05/as-twitter-protects-its-ecosystem-heres-how-to-create-an-rss-feed-of-a-twitter-list/">this site</a>, it looks like there’s a more straightforward way of getting the RSS feed. Using the same list we were trying to get above, it looks like this also works:</p>

<blockquote>
  <p>http://api.twitter.com/1/nathansmith/lists/javascript/statuses.atom</p>
</blockquote>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/2011/android-3-0-honeycomb-is-first-to-implement-the-device-api">
			
				Android 3.0 Honeycomb Is First to Implement the Device API</a>
		</h2>
		<div class="meta date">








  


<time datetime="2011-02-24T00:00:00-08:00" pubdate data-updated="true">Feb 24<span>th</span>, 2011</time></div>
	</header>
	<div class="entry-content">
		<p>I fired up the newly released Android 3.0 SDK to run some tests and found they’ve implemented part of the long-awaited <a href="http://www.w3.org/2009/dap/">Device API</a> (aka the Media Capture API). From your browser you can now upload pictures and videos from the camera as well as sounds from the microphone. The returned data should be available to manipulate via the <a href="http://www.w3.org/TR/FileAPI/">File API</a> (although I haven’t yet tested this).</p>

<p>I made a <a href="http://www.youtube.com/watch?v=L1XqvLOi-3I">short video demo</a> with some explanation:</p>

<p>Here’s the code so you can play around with it for yourself!</p>

<pre name="code" class="html">&lt;form enctype="multipart/form-data" method="post"&gt;
  &lt;h2&gt;Regular file upload&lt;/h2&gt;
  &lt;input type="file"&gt;&lt;/input&gt;
  
  &lt;h2&gt;capture=camera&lt;/h2&gt;
  &lt;input type="file" accept="image/*;capture=camera"&gt;&lt;/input&gt;
  
  &lt;h2&gt;capture=camcorder&lt;/h2&gt;
  &lt;input type="file" accept="video/*;capture=camcorder"&gt;&lt;/input&gt;
  
  &lt;h2&gt;capture=microphone&lt;/h2&gt;
  &lt;input type="file" accept="audio/*;capture=microphone"&gt;&lt;/input&gt;
&lt;/form&gt;
</pre>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/2011/my-oreilly-books-wishlist">
			
				My O&#8217;Reilly Books Wishlist</a>
		</h2>
		<div class="meta date">








  


<time datetime="2011-02-22T00:00:00-08:00" pubdate data-updated="true">Feb 22<span>nd</span>, 2011</time></div>
	</header>
	<div class="entry-content">
		<h3 id="introduction">Introduction</h3>

<p>Ok, so this post is only here in the hopes I’ll actually win something. <img src="http://davidbcalhoun.com/wp-includes/images/smilies/icon_razz.gif" alt=":P" class="wp-smiley" /> </p>

<p><a href="http://oreilly.com/new-year-2011.html">O’Reilly Books has a promotion</a> where a random winner will receive up to $500 of books on their wishlist, provided they post the list somewhere online. You can probably see why this is here then!</p>

<h3 id="the-list">The List</h3>

<p><a href="http://oreilly.com/catalog/9780596807788/">Programming the Mobile Web</a> ($50)<br />
<a href="http://oreilly.com/catalog/9780596155254/">Palm webOS</a> ($45)<br />
<a href="http://oreilly.com/catalog/9781449381561/">MongoDB: The Definitive Guide</a> ($40)<br />
<a href="http://oreilly.com/catalog/9781449393847/">JavaScript: The Definitive Guide: Rough Cuts Version, Sixth Edition</a> ($50)<br />
<a href="http://oreilly.com/catalog/9780596806026/">HTML5: Up and Running</a> ($30)<br />
<a href="http://oreilly.com/catalog/9781449383268/">Building Android Apps with HTML, CSS, and JavaScript</a> ($30)<br />
<a href="http://oreilly.com/catalog/9780596805784/">Building iPhone Apps with HTML, CSS, and JavaScript</a> ($30)<br />
<a href="http://oreilly.com/catalog/9780596157609/">HTML &#038; CSS: The Good Parts</a> ($35)<br />
<a href="http://oreilly.com/catalog/9781449393908/">HTML5 Canvas</a> ($40)<br />
<a href="http://oreilly.com/catalog/9780596159771/">jQuery Cookbook</a> ($35)<br />
<a href="http://oreilly.com/catalog/9781449390501/">Learning Android</a> ($35)<br />
<a href="http://oreilly.com/catalog/9780596155933/">CSS Cookbook, Third Edition</a> ($50)</p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/2011/improving-yourself-as-a-programmer-versus-as-a-human-being">
			
				Improving Yourself as a Programmer Versus as a Human Being</a>
		</h2>
		<div class="meta date">








  


<time datetime="2011-02-20T00:00:00-08:00" pubdate data-updated="true">Feb 20<span>th</span>, 2011</time></div>
	</header>
	<div class="entry-content">
		<p>(OR “The Post In Which I Conflate Programming and Philosophy” OR “The Programmer’s Existentialist Crisis”)</p>

<p>I woke up this morning to read Dmitry A. Soshnikov’s tweet:<br />
<a href="http://twitter.com/#!/DmitrySoshnikov/status/39356492058607616"><img src="http://davidbcalhoun.com/wp-content/uploads/2011/02/two-programming-languages.png" alt="Have one-two langs in which you are a master and know professionally, and in addition, consider alternative langs. Your experience will grow." width="661" height="318" class="aligncenter size-full wp-image-639" /></a></p>

<p>While this seems like good advice for aspiring programmers, I can’t help but think what this means for those who will buy into this. Us programmers have a keen ability to sit and focus on problems for extended periods of time, usually to the detriment of everything else around us. From the perspective of “real life”, we might as well be sitting in a basement somewhere playing World of Warcraft. Sure, programming is more productive, profitable, and surely not brainless, but at the end of the day we could still only be sitting in a basement somewhere. What I mean to say here is that we’re not actually living our actual lives doing these things.</p>

<p>I realize Dmitry was only talking about learning another programming language for professional life, but for me and so many others, professional life is not easily separated from personal life. We don’t just work during the week during work hours. We can’t just turn off our minds and stop thinking about it when we go home. I end up thinking about programming or web design puzzles in my leisure time and on weekends, largely <em>because I enjoy doing so</em>. But when I see something questioning whether I should be devoting even more of this time to learning another programming language, I think about what I could be doing instead. Put another way, I think about what is missing and neglected in my life, and how those things will remain missing and neglected.</p>

<p>Socrates famously said <a href="http://en.wikiquote.org/wiki/Socrates#Apology">“The unexamined life is not worth living”</a>. He, along with those who followed in his immediate footsteps (famously, Plato and Aristotle) were concerned with how us mere mortals should live our lives, and more particularly how we should lead <em>good</em> lives. The sad fact about (western) philosophy is that it’s turned into a shadow of its former self, now plagued by millennia of self-doubt and failed grandiose systems. But it seems the original Socratic intention of finding how to lead a <em>good</em> life is still an admirable goal, even if we disagree on how exactly to achieve it.</p>

<p>Socrates also had a bit to say about those seeking to be experts in their field, and he couldn’t resist getting in a jab at his wife in the process:</p>

<blockquote>
  <p>It is the example of the rider who wishes to become an expert horseman: “None of your soft-mouthed, docile animals for me,” he says; “the horse for me to own must show some spirit” in the belief, no doubt, if he can manage such an animal, it will be easy enough to deal with every other horse besides. And that is just my case. I wish to deal with human beings, to associate with man in general; hence my choice of wife. I know full well, if I can tolerate her spirit, I can with ease attach myself to every human being else.</p>
</blockquote>

<p>Yes, Socrates essentially just compared his wife with a horse. A wild horse, to be exact.</p>

<p>I’m unsure if this translates well into learning programming languages. Does this mean we should learn the worst languages first, so that the rest of the languages we learn will be comparably easy? I hope not, that seems like quite a lot of wasted time. But I certainly agree that <em>the first languages we learn shouldn’t be the easiest</em>. This might only make us frustrated in the long run. So perhaps we can learn something from Socrates’s quote after all, if taken with a grain of salt.</p>

<p>So should we still strive to become experts in our field? I believe that’s an admirable and acceptable goal, but it shouldn’t be our main goal. We should first be concerned with leading good lives. I myself have a LONG way to go on this point, believe me.</p>

<p>I’ll surely learn another programming language, but not for its own sake, unless my life is in reasonably good order.</p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/2011/checking-for-undefined-null-and-empty-variables-in-javascript">
			
				Checking for Undefined, Null, and Empty Variables in JavaScript</a>
		</h2>
		<div class="meta date">








  


<time datetime="2011-02-11T00:00:00-08:00" pubdate data-updated="true">Feb 11<span>th</span>, 2011</time></div>
	</header>
	<div class="entry-content">
		<p>In general it’s a good practice to check for the existence of something before blindly using it by faith and hoping it works. There are various times during the execution of scripts when a variable may not be defined, it may be null, or it might be an empty string. These are three things that are easily conflated. A good way to look at this is thinking of these as having increasing levels of existence (getting a bit philosophical here for a moment…):</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
</pre></td>
  <td class="code"><pre>foo0;             <span class="comment">// existence level 0 (creates the error &quot;not defined&quot;)</span>
<span class="keyword">var</span> foo1;         <span class="comment">// existence level 1 (&quot;undefined&quot; - variable declared but not defined/initialized)</span>
<span class="keyword">var</span> foo2 = <span class="predefined-constant">null</span>;  <span class="comment">// existence level 2 (variable initialized, but isn't an Object, Number, String, etc)</span>
<span class="keyword">var</span> foo3 = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;    <span class="comment">// existence level 3 (variable initialized to an empty String)</span>
<span class="keyword">var</span> foo4 = <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>; <span class="comment">// existence level 4 (variable initialized to String &quot;foo&quot;)</span>
</pre></td>
</tr></table>
</div>

<p>Generally it would be handy if we had some way to filter out everything but the very last line. We simply want to check for these cases without the script entirely blowing up, as it does with the first line:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
</pre></td>
  <td class="code"><pre>foo;  <span class="comment">// ReferenceError: foo is not defined</span>
</pre></td>
</tr></table>
</div>

<p>We’re not particularly doing anything useful with foo here, but notice that the script fails out anyway. At this point any code that follows will not be executed. Your first instinct might be “Oh! I know how to contain these errors! We’ll use a try-catch!”:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
</pre></td>
  <td class="code"><pre><span class="keyword">try</span> {
  foo;
} <span class="keyword">catch</span>(e) {
  e.message;  <span class="comment">// &quot;foo is not defined&quot;</span>
}
</pre></td>
</tr></table>
</div>

<p>The script still fails, but not critically, so your script continues to execute. But this turns out to aversely affect performance. The basic lesson here is that try-catch can be useful in some situations, but shouldn’t be used where alternatives are available.</p>

<h3 id="typeof-foo">typeof foo</h3>

<p>JavaScript has quite a useful remedy for this:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
</pre></td>
  <td class="code"><pre><span class="keyword">typeof</span> foo; <span class="comment">// &quot;undefined&quot;</span>
</pre></td>
</tr></table>
</div>

<p>Unlike everything else in JavaScript, typeof will deal with whatever you throw at it, including undefined variables. So you can use it as a simple check before using a variable that might not exist:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
</pre></td>
  <td class="code"><pre><span class="keyword">if</span>(<span class="keyword">typeof</span> foo !== <span class="string"><span class="delimiter">&quot;</span><span class="content">undefined</span><span class="delimiter">&quot;</span></span>) {
  <span class="comment">// do something with foo</span>
}
</pre></td>
</tr></table>
</div>

<p>Note that this is easy to confuse with the <code>undefined</code> keyword, which in this case doesn’t help us one bit, as it gives us a fatal error:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
</pre></td>
  <td class="code"><pre><span class="keyword">if</span>(foo !== <span class="predefined-constant">undefined</span>) {  <span class="comment">// ReferenceError: foo is not defined</span>

}
</pre></td>
</tr></table>
</div>

<p>This filters out our first two cases, since they both evaluate to “undefined”:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
</pre></td>
  <td class="code"><pre><span class="keyword">typeof</span> foo; <span class="comment">// &quot;undefined&quot;</span>

<span class="keyword">var</span> bar;
<span class="keyword">typeof</span> bar; <span class="comment">// &quot;undefined&quot;</span>
</pre></td>
</tr></table>
</div>

<p>But this turns out not to work well for our other conditions, which evaluate differently:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
</pre></td>
  <td class="code"><pre><span class="keyword">typeof</span> <span class="predefined-constant">null</span>;  <span class="comment">// &quot;object&quot; (what?!)</span>
<span class="keyword">typeof</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;    <span class="comment">// &quot;string&quot;</span>
</pre></td>
</tr></table>
</div>

<p>So we need to add other “if” conditions to check.. but there turns out to be a better way!</p>

<h3 id="exploiting-loose-typing">Exploiting loose typing</h3>

<p>JavaScript is a loosely typed language, which means that it will “automagically” cast variables into other types when necessary (i.e. when adding a Number to a String), sometimes resulting in the unexpected. For instance, whenever we use the “if” statement, the expected input is a Boolean true/false value. If JavaScript gets anything other than a Boolean, such as a String or a Number, instead of blowing up completely (as in strictly typed languages such as C), it’ll cast the variable into a Boolean for you.</p>

<p>“How handy!” you might think. Except in the following unexpected cases:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
</pre></td>
  <td class="code"><pre><span class="keyword">if</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>) {
  <span class="comment">// this will run because &quot;0&quot; is true</span>
}

<span class="keyword">if</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>) {
  <span class="comment">// this will run because &quot;false&quot; is true</span>
}
</pre></td>
</tr></table>
</div>

<p>To see what JavaScript will cast a value to without having to use an <code>if</code> statement, we could create a new Boolean value with the following:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
</pre></td>
  <td class="code"><pre>Boolean(<span class="integer">0</span>);    <span class="comment">// false</span>
Boolean(<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>);  <span class="comment">// true</span>
</pre></td>
</tr></table>
</div>

<p>Or we can use the less intuitive but quick way of using double exclamation marks (this will probably award you cleverness points in someone’s book.. hopefully those points actually matter):</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
</pre></td>
  <td class="code"><pre>!!<span class="integer">0</span>;    <span class="comment">// false</span>
!!<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>;  <span class="comment">// true</span>
</pre></td>
</tr></table>
</div>

<p>This works because !foo converts foo to a Boolean but negates its original value, turning it on its head. !!foo converts foo to a Boolean and flips it back to its expected value, which is the same value that’s evaluated by our <code>if</code> statement.</p>

<p>Using this ALMOST gives us the answer we’re looking for:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
<strong><a href="#n10" name="n10">10</a></strong>
<a href="#n11" name="n11">11</a>
<a href="#n12" name="n12">12</a>
<a href="#n13" name="n13">13</a>
</pre></td>
  <td class="code"><pre>!!foo0; <span class="comment">// ReferenceError: foo0 is not defined</span>

<span class="keyword">var</span> foo1;
!!foo1; <span class="comment">// false</span>

<span class="keyword">var</span> foo2 = <span class="predefined-constant">null</span>;
!!foo2; <span class="comment">// false (same as !!null)</span>

<span class="keyword">var</span> foo3 = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
!!foo3; <span class="comment">// false (same as !!&quot;&quot;)</span>

<span class="keyword">var</span> foo4 = <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>;
!!foot4; <span class="comment">// true (same as !!&quot;bar&quot;)</span>
</pre></td>
</tr></table>
</div>

<p>Excluding the first example, now we can test for uninitialized variables (foo1), null variables (foo2), and empty strings (foo3) all with just an <code>if</code> statement:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
<strong><a href="#n10" name="n10">10</a></strong>
<a href="#n11" name="n11">11</a>
</pre></td>
  <td class="code"><pre><span class="keyword">if</span>(foo1) {
  <span class="comment">// do something with foo1</span>
}

<span class="keyword">if</span>(foo2) {
  <span class="comment">// do something with foo2</span>
}

<span class="keyword">if</span>(foo3) {
  <span class="comment">// do something with foo3</span>
}
</pre></td>
</tr></table>
</div>

<p>Dang… so close! But we can’t yet test the first case without an error:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
</pre></td>
  <td class="code"><pre><span class="keyword">if</span>(foo0) {  <span class="comment">// ReferenceError: foo0 is not defined</span>

}
</pre></td>
</tr></table>
</div>

<h3 id="foo-versus-windowfoo-and-thisfoo">foo versus window.foo and this.foo</h3>

<p>The secret to our solution lies in how JavaScript handles undefined variables versus undefined properties. Here’s a quick reminder on the difference between the two:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
</pre></td>
  <td class="code"><pre><span class="comment">// variable foo</span>
<span class="keyword">var</span> foo;

<span class="comment">// property bar (and object variable foo)</span>
<span class="keyword">var</span> foo = {};  <span class="comment">// create an empty object to add bar too</span>
foo.bar = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
</pre></td>
</tr></table>
</div>

<p>The difference between these makes all the difference whether a fatal error occurs:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
</pre></td>
  <td class="code"><pre>foo;  <span class="comment">// ReferenceError: foo is not defined</span>

<span class="keyword">var</span> foo = {};
foo.bar;  <span class="comment">// undefined</span>
foo.blah; <span class="comment">// undefined</span>
</pre></td>
</tr></table>
</div>

<p>We can randomly invent and check any property of <code>foo</code> we want, and the code will keep chugging along:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
<strong><a href="#n10" name="n10">10</a></strong>
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> foo = {};
foo.something = <span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>;

<span class="keyword">if</span>(foo.bar) { <span class="comment">// undefined, interpreted as false (same as !!foo.bar)</span>
  <span class="comment">// never runs</span>
}

<span class="keyword">if</span>(foo.something) {
  foo.something;  <span class="comment">// &quot;hello&quot;</span>
}
</pre></td>
</tr></table>
</div>

<p>Now comes the magic. If you know anything about JavaScript running in the browser, you know that all global variables are part of the <code>window</code> object. This means <code>foo</code> and <code>window.foo</code> are equivalent:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> foo;

foo === window.foo;  <span class="comment">// true</span>

<span class="comment">// &quot;this&quot; is another bag of worms, but note this anyway</span>
<span class="local-variable">this</span>.foo === window.foo;
</pre></td>
</tr></table>
</div>

<p>So technically our variable foo is a <em>property</em> of the window object. So we should be able to check for any arbitrary variable in the window scope now!</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
</pre></td>
  <td class="code"><pre>window.foo;  <span class="comment">// undefined (not a fatal error!)</span>

<span class="comment">// even though we're checking for the same thing, we get a fatal error…</span>
foo;  <span class="comment">// ReferenceError: foo is not defined</span>
</pre></td>
</tr></table>
</div>

<h3 id="practical-uses">Practical uses</h3>

<p>Now as long as we have a global entry point for our code, we can write our code in such a way that it won’t ever give us a fatal error if our variables aren’t yet defined:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
</pre></td>
  <td class="code"><pre><span class="keyword">if</span>(window.foo &amp;&amp; foo.bar) {
  foo.bar();
}
</pre></td>
</tr></table>
</div>

<p>Of course nothing happens, because we haven’t defined foo. But why doesn’t foo.bar give us a fatal error? Because the first test, <code>window.foo</code> failed out. It would be useless processing for the JavaScript engine to also evaluate the second statement, because the end result will still be the same (false &#038;&#038; true results in false, false &#038;&#038; false results in false). So it doesn’t get so far as <code>foo.bar</code>.</p>

<p>And now the code will work properly when we hook up our code to our <code>foo</code> global namespace:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> foo = {
  <span class="function">bar</span>: <span class="keyword">function</span>() {
    alert(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello world</span><span class="delimiter">&quot;</span></span>);
  }
}

<span class="keyword">if</span>(window.foo &amp;&amp; foo.bar) {
  foo.bar();  <span class="comment">// &quot;hello world&quot;</span>
}
</pre></td>
</tr></table>
</div>

<h3 id="shorthand">Shorthand</h3>

<p>It’s becoming common to see an abbreviation for the above code. Check out the following two methods, which accomplish the same thing:</p>

<div><table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
</pre></td>
  <td class="code"><pre><span class="comment">// Method 1</span>
<span class="keyword">if</span>(window.foo &amp;&amp; foo.bar) {
  foo.bar();  <span class="comment">// &quot;hello world&quot;</span>
}

<span class="comment">// Method 2</span>
window.foo &amp;&amp; foo.bar &amp;&amp; (foo.bar());
</pre></td>
</tr></table>
</div>

<p>Don’t get too scared.. these blocks of code are equivalent. Method 2 is shorter, but it simply goes something like this: if window.foo isn’t set, stop evaluating this line (just as above in the <code>if</code> statement). Otherwise, if foo.bar exists then execute the code in parentheses, which gives us an alert (“hello world”);</p>

<p>Just a word of caution about using Method 2: it’s obviously less clear what’s going on here. Your own cleverness might actually result in unnecessary confusion, especially of other people work in the same code base and they’re at different levels of understanding. In these cases we should first strive to be clear, and then only clever if it’s not at the expense of being clear.</p>

<p>It’s also likely that a code minifier would take care of this cleverness for us at build time, giving us the best of both worlds.</p>

		
		
	</div>

</article>

<nav id="pagenavi">
    
        <a href="/blog/page/3/" class="prev">Previous</a>
    
    
        <a href="/blog/page/5/" class="next">Next</a>
    
</nav>
</div>
	<footer id="footer" class="inner"><br>
<br>
<br>
<br>
&copy; 2014
<a href="mailto:david.b.calhoun@gmail.com">David Calhoun</a> (<a href="https://twitter.com/franksvalli">@franksvalli</a>) - <a href="https://www.linkedin.com/in/davidcalhoun">LinkedIn</a> - <a href="http://themaingate.net/resume/">Resume</a></footer>
	<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="/javascripts/slash.js"></script> -->
<!-- <script src="/javascripts/hyphenator.js"></script> -->


<script type="text/javascript">
      var disqus_shortname = 'davidbcalhoun';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




<script src="/javascripts/main.js"></script>
<!-- <script src="/javascripts/negative-scroll-blur.js"></script> -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5530615-3', 'davidbcalhoun.com');
  ga('send', 'pageview');

</script>

</body>
</html>
