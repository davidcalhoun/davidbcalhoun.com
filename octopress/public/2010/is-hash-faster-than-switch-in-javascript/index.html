
<!DOCTYPE HTML>
<html lang="en-GB">
<head>
	<meta charset="utf-8">
	<title>Is a hash faster than a Switch in JavaScript?  | David Calhoun's blog</title>

	<meta name="author" content="David Calhoun">

<meta name="description" content="I stumbled across this concept recently and I thought I’d share it, because I don’t generally see this pattern being used. More importantly, I also &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="David Calhoun's blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="/javascripts/html5.js"></script><![endif]-->
	

</head>



<body>
	<header id="header" class="inner"><h1><a href="/">David Calhoun's blog</a></h1>
<span class="tagline"></span>
<!-- <nav id="main-nav"><ul>
	<li><a href="/about">About</a></li>
	<li><a href="/archives">Archives</a></li>
	<li><a href="/contact">Contact</a></li>
</ul>
</nav> -->
<!-- <nav id="mobile-nav"> -->
<!-- 	<div class="alignleft menu"> -->
<!-- 		<a class="button">Menu</a> -->
<!-- 		<div class="container"><ul>
	<li><a href="/about">About</a></li>
	<li><a href="/archives">Archives</a></li>
	<li><a href="/contact">Contact</a></li>
</ul>
</div> -->
<!-- 	</div> -->
<!-- </nav> -->


</header>

	<div id="content" class="inner"><article class="post">
	<header>
		<h2 class="title">Is a Hash Faster Than a Switch in JavaScript?</h2>
		<div class="meta date">








  


<time datetime="2010-08-17T00:00:00-07:00" pubdate data-updated="true">Aug 17<span>th</span>, 2010</time></div>
	</header>
	<div class="entry-content"><p>I stumbled across this concept recently and I thought I’d share it, because I don’t generally see this pattern being used. More importantly, I also share test results that show that maybe it’s not always a good idea to use this pattern…</p>

<h3 id="the-problem-with-switch-statements">The problem with Switch statements</h3>

<p>The basic switch statement in JavaScript looks something like this:</p>

<pre name="code" class="JScript">var foo = 'c';

switch(foo) {
  case 'a':
  break;

  case 'b':
  break;

  case 'c':
  break;

  default:
}
</pre>

<p>So what’s wrong with this? The JS engine has to examine a bunch of unrelated cases until it finds the relevant one, executes the code, then breaks out of the switch because the job is done (this is why it’s important to break!). In the above example we had to go through case A and case B until finally reaching case C. What’s worse is that if it didn’t match any of these cases, the JS engine has to jump through ALL of the cases before it reaches Default, the fall-through case.</p>

<p>Actually it’s not so bad, as long as there are a limited number of cases. It’s probably no big deal if you only have a few cases to jump through. The problem gets bigger as your number of cases increases (some of you may know this as <a href="http://en.wikipedia.org/wiki/Big_O_notation">O(n)</a>). What happens when there’s 10 cases? Then there’s potentially 10 checks on cases (assuming what ended up being executed was the default). 100 cases? Then potentially 100 checks.</p>

<p>What would be better is if there were a way to reduce the number of checks. One way would be to put the most frequently used cases at the top. This would alleviate some of the pain, but you still end up with extra processing while the JS checks each case. It would be ideal to avoid this extra processing altogether.</p>

<h3 id="an-alternative-the-hash-table">An alternative: The hash table</h3>

<p>There is a way to avoid this extra processing! It’s by leading the code directly where it needs to go, without unnecessary checking of unrelated cases.</p>

<p>You can do this using a hash. In JavaScript we accomplish this with an object:</p>

<pre name="code" class="JScript">var foo = 'c';
var cases = {};
cases['a'] = function() {
  alert('I am A!');
};
cases['b'] = function() {
  alert('I am B!');
};
cases['c'] = function() {
  alert('I am C!');
}

if(typeof cases[foo] == 'function') {
  // only executes if we've defined it above
  cases[foo]();  // I am C!
} else {
  // default (the fallthrough)
}
</pre>

<p>There we go! No extra case checking here. We’ve led the JS straight to the code we want to execute!</p>

<h3 id="performance-improvement8230">Performance improvement…?</h3>

<p>So.. this hash lookup seems faster in theory, but what about in practice? Unfortunately I ended up with some mixed results…</p>

<p>I created a <a href="http://jsperf.com/switch-vs-hash/3">simple performance test on jsperf.com</a> and got these results:</p>

<table>
  <tr>
    <td>
      Browser
    </td>
    
    <td>
      Switch ops/sec
    </td>
    
    <td>
      Hash table ops/sec
    </td>
    
    <td>
      % Difference
    </td>
  </tr>
  
  <tr>
    <td>
      Chrome 6.0.490.1 dev
    </td>
    
    <td class="negative">
      34,606,469
    </td>
    
    <td class="positive">
      43,329,587
    </td>
    
    <td class="positive">
      25% faster
    </td>
  </tr>
  
  <tr>
    <td>
      Safari 5.0
    </td>
    
    <td class="positive">
      16,777,216
    </td>
    
    <td class="negative">
      10,854,824
    </td>
    
    <td class="negative">
      35% slower
    </td>
  </tr>
  
  <tr>
    <td>
      Opera 10.61
    </td>
    
    <td class="positive">
      4,405,782
    </td>
    
    <td class="negative">
      2,719,336
    </td>
    
    <td class="negative">
      38% slower
    </td>
  </tr>
  
  <tr>
    <td>
      Firefox 3.6.3
    </td>
    
    <td class="positive">
      2,785,802
    </td>
    
    <td class="negative">
      2,400,586
    </td>
    
    <td class="negative">
      14% slower
    </td>
  </tr>
  
  <tr>
    <td>
      IE6
    </td>
    
    <td class="negative">
      147,870
    </td>
    
    <td class="positive">
      206,869
    </td>
    
    <td class="positive">
      40% faster
    </td>
  </tr>
  
  <tr>
    <td>
      IE7
    </td>
    
    <td class="negative">
      144,735
    </td>
    
    <td class="positive">
      191,179
    </td>
    
    <td class="positive">
      32% faster
    </td>
  </tr>
  
  <tr>
    <td>
      IE8
    </td>
    
    <td class="negative">
      350,085
    </td>
    
    <td class="positive">
      472,417
    </td>
    
    <td class="positive">
      35% faster
    </td>
  </tr>
  
  <tr>
    <td>
      Mobile Safari (iOS4 on iPhone 3GS)
    </td>
    
    <td class="positive">
      668,053
    </td>
    
    <td class="negative">
      416,366
    </td>
    
    <td class="negative">
      37% slower
    </td>
  </tr>
  
  <tr>
    <td>
      Android (2.2 on Nexus One)
    </td>
    
    <td class="negative">
      605,693
    </td>
    
    <td class="positive">
      864,591
    </td>
    
    <td class="positive">
      42% faster
    </td>
  </tr>
</table>

<ul>
  <li>Ops/sec = Operations per second. Higher is better<br />
** Chrome, Safari, Opera, and Firefox were tested on Mac OSX 10.6.4 2.53GHz Intel Core i5. IE tests were run on Windows 7 64bit 2.4GHz Quad Core</li>
</ul>

<h3 id="the-results">The Results</h3>

<p>From the results, it looks like the hash optimization is only a benefit for Chrome, IE6-IE8, and Android. That’s quite a specific sampling. My guess is that the other browsers have implemented some sort of Switch statement optimizations that actually turn the hash optimization into an antipattern.</p>

<h3 id="more-info">More info</h3>

<p>Although I first read about this online, by no surprise this trick also appears in <a href="http://www.nczonline.net/">Nicholas Zakas’s</a> <a href="http://www.amazon.com/Performance-JavaScript-Faster-Application-Interfaces/dp/059680279X">High Performance JavaScript</a> in a section on “Lookup Tables” (p. 72).</p>

</div>

</article>

	
	<div class="share">
	  <!-- <ul> -->
	  <!--   <li>
  <a href="https://twitter.com/intent/tweet?text=Is a hash faster than a Switch in JavaScript? by @&url=http://davidbcalhoun.com/2010/is-hash-faster-than-switch-in-javascript" title="Share Is a hash faster than a Switch in JavaScript? on Twitter">
    <img src="/images/social/twitter.png" />
  </a>
</li>
 -->
	  <!--   <li>
  <a href="https://www.facebook.com/sharer.php?u=http://davidbcalhoun.com/2010/is-hash-faster-than-switch-in-javascript" title="Share Is a hash faster than a Switch in JavaScript? on Facebook">
    <img src="/images/social/facebook.png" />
  </a>
</li>
 -->
	  <!--   <li>
  <a href="https://plus.google.com/share?url=http://davidbcalhoun.com/2010/is-hash-faster-than-switch-in-javascript" title="Share Is a hash faster than a Switch in JavaScript? on Google Plus">
    <img src="/images/social/google.png" />
  </a>
</li>
 -->
	  <!-- </ul> -->
	</div>




<section id="comment">
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner"><br>
<br>
<br>
<br>
&copy; 2014
<a href="mailto:david.b.calhoun@gmail.com">David Calhoun</a> (<a href="https://twitter.com/franksvalli">@franksvalli</a>) - <a href="https://www.linkedin.com/in/davidcalhoun">LinkedIn</a> - <a href="http://themaingate.net/resume/">Resume</a></footer>
	<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="/javascripts/slash.js"></script> -->
<!-- <script src="/javascripts/hyphenator.js"></script> -->


<script type="text/javascript">
      var disqus_shortname = 'davidbcalhoun';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://davidbcalhoun.com/2010/is-hash-faster-than-switch-in-javascript';
        var disqus_url = 'http://davidbcalhoun.com/2010/is-hash-faster-than-switch-in-javascript';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




<script src="/javascripts/main.js"></script>
<!-- <script src="/javascripts/negative-scroll-blur.js"></script> -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5530615-3', 'davidbcalhoun.com');
  ga('send', 'pageview');

</script>

</body>
</html>
