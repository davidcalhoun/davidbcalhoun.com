<!doctype html>
<html lang="en-US">
<head>
	<meta charset="utf-8">
	<title>async.parallel with a simple timeout (node.js)  | David Calhoun's blog</title>

	<meta name="author" content="David Calhoun">

<meta name="description" content="A while back I had a need for a general timeout option for async.parallel and was surprised I couldn’t find much information about how to do it. I &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="David Calhoun's blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="/javascripts/html5.js"></script><![endif]-->
	

</head>



<body>
	<header id="header" class="inner" role="banner" aria-labelledby="header_title"><h1><a href="/" id="header_title">David Calhoun's blog</a></h1>
<span class="tagline"></span>

</header>
	<div id="content" class="inner" role="main"><article class="post" role="main">
	<header>
		<h2 class="title">async.parallel With a Simple Timeout (node.js)</h2>
		<div class="meta date">








  


<time datetime="2014-09-08T00:36:52-07:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content"><p>A while back I had a need for a general timeout option for async.parallel and was surprised I couldn’t find much information about how to do it.  I was using async.parallel to make a lot of REST calls in parallel, but one of them was getting blocked by a firewall, resulting in an eventual timeout minutes later.</p>

<p>One option was to specify a shorter timeout for each individual REST call, including the one causing the problem.  But I wanted a simpler solution: a general timeout for that specific async.parallel instance that made it clear all tasks should finish within a certain period of time. Otherwise return a timeout as an error, allowing the program to continue (and retry if necessary).</p>

<p>It was somewhat surprising there wasn’t an option built into async.parallel, as I could imagine other folks must have had the same problem at some point in time.</p>

<p>In any case, I wrote a pretty simple wrapper function that gets the job done (see example usage below):</p>

<pre lang="javascript"><code>var async = require('async');

// async.parallel with optional timeout (options.timeoutMS)
function parallel(options, tasks, cb) {
	//  sanity checks
	options = options || {};

	// no timeout wrapper; passthrough to async.parallel
	if(typeof options.timeoutMS != 'number') return async.parallel(tasks, cb);

	var timeout = setTimeout(function(){
		// remove timeout, so we'll know we already erred out
		timeout = null;

		// error out
		cb('async.parallel timed out out after ' + options.timeoutMS + 'ms.', null);
	}, options.timeoutMS);

	async.parallel(tasks, function(err, result){
		// after all tasks are complete

		// noop if timeout was called and annulled
		if(!timeout) return;

		// cancel timeout (if timeout was set longer, and all parallel tasks finished sooner)
		clearTimeout(timeout);

		// passthrough the data to the cb
		cb(err, result);
	});
}


// example usage
parallel({timeoutMS: 10000}, [  // 10 second timeout
	function(){ ... },
	function(){ ... }
],
function(err, results) {
	if(err) {
		// timeouts can now be handled here
	}
});


// an example forcing a timeout to occur
parallel({
	timeoutMS: 1000   // 1 second timeout
},
[
	function(done){
		// task 1 completes in 100ms
		setTimeout(function(){
			done(null, 'foo');
		}, 100);
	},
	function(done){
		// task 2 completes in 2000ms, forcing a timeout error
		setTimeout(function(){
			done(null, 'bar');
		}, 2000);
	}
],
function(err, results) {
	// err = 'async.parallel timed out out after 1000ms.'
});
</code></pre>
</div>

</article>

	
	<div class="share">
	  <!-- <ul> -->
	  <!--   <li>
  <a href="https://twitter.com/intent/tweet?text=async.parallel with a simple timeout (node.js) by @&url=http://davidbcalhoun.com/2014/async.parallel-with-a-simple-timeout-node-js/" title="Share async.parallel with a simple timeout (node.js) on Twitter">
    <img src="/images/social/twitter.png" />
  </a>
</li>
 -->
	  <!--   <li>
  <a href="https://www.facebook.com/sharer.php?u=http://davidbcalhoun.com/2014/async.parallel-with-a-simple-timeout-node-js/" title="Share async.parallel with a simple timeout (node.js) on Facebook">
    <img src="/images/social/facebook.png" />
  </a>
</li>
 -->
	  <!--   <li>
  <a href="https://plus.google.com/share?url=http://davidbcalhoun.com/2014/async.parallel-with-a-simple-timeout-node-js/" title="Share async.parallel with a simple timeout (node.js) on Google Plus">
    <img src="/images/social/google.png" />
  </a>
</li>
 -->
	  <!-- </ul> -->
	</div>




<section id="comment">
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner" role="contentinfo"><br>
<br>
<br>
<br>
&copy; 2016
<a href="mailto:david.b.calhoun@gmail.com">David Calhoun</a> (<a href="https://twitter.com/franksvalli">@franksvalli</a>) - <a href="https://www.linkedin.com/in/davidcalhoun">LinkedIn</a> - <a href="http://themaingate.net/resume/">Resume</a></footer>
	<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="/javascripts/slash.js"></script> -->
<!-- <script src="/javascripts/hyphenator.js"></script> -->


<script type="text/javascript">
      var disqus_shortname = 'davidbcalhoun';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://davidbcalhoun.com/2014/async.parallel-with-a-simple-timeout-node-js/';
        var disqus_url = 'http://davidbcalhoun.com/2014/async.parallel-with-a-simple-timeout-node-js/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




<script src="/javascripts/main.js" defer></script>
<!-- <script src="/javascripts/negative-scroll-blur.js"></script> -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5530615-3', 'davidbcalhoun.com');
  ga('send', 'pageview');

</script>

</body>
</html>
