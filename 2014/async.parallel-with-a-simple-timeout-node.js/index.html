<!doctype html><html lang=en-US prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="David Calhoun"><title>async.parallel with a simple timeout (node.js) - David Calhoun's blog</title><style>html body{font-family:roboto,sans-serif}</style><link rel=stylesheet href=https://www.davidbcalhoun.com/css/main.min.ed189e9bcb0c5d3b97ea9c4bca48f5b8e6bc300bbf923dc272441485706475b6.css><link rel=preconnect href=https://comments.davidbcalhoun.com><link rel=preconnect href=https://ssl.gstatic.com><link rel=preconnect href=https://cdnjs.cloudflare.com><link rel=preconnect href=https://accounts.google.com><link rel=preconnect href=https://apis.google.com><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><link rel=preload href=/commento.css as=style><meta name=generator content="Hugo 0.147.1"><style>@font-face{font-family:roboto;font-style:normal;font-weight:400;font-display:swap;src:local('Roboto'),local('Roboto-Regular'),url(/wp-content/fonts/roboto-v20-latin-regular.woff2)format('woff2'),url(/wp-content/fonts/roboto-v20-latin-regular.woff)format('woff')}</style><meta name=description content="Personal blog of photographer and web developer David Calhoun."><link rel=canonical href=https://www.davidbcalhoun.com/2014/async.parallel-with-a-simple-timeout-node.js/><link href=/index.xml rel=alternate type=application/rss+xml title="David Calhoun's blog"><link href=/index.xml rel=feed type=application/rss+xml title="David Calhoun's blog"><link href=/index.xml rel=self type=application/rss+xml title="David Calhoun's blog"><meta name=format-detection content="telephone=no"><meta itemprop=name content="async.parallel with a simple timeout (node.js)"><meta itemprop=headline content="async.parallel with a simple timeout (node.js)"><meta itemprop=author content="David Calhoun"><link rel=me href=https://www.themaingate.net/ type=text/html><link rel=me href=mailto:david.b.calhoun+dc@gmail.com><link rel=me href=https://www.linkedin.com/in/davidcalhoun/ type=text/html><link rel=me href=https://github.com/davidcalhoun type=text/html><link rel=me href=https://twitter.com/franksvalli type=text/html><link rel=archives href=https://example.com/archives/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:url" content="https://www.davidbcalhoun.com/2014/async.parallel-with-a-simple-timeout-node.js/"><meta property="og:title" content="async.parallel with a simple timeout (node.js)"><meta property="og:site_name" content="David Calhoun's Blog"><meta property="og:updated_time" content=2014-09-08T00:36:52-0700><meta property="article:published_time" content=2014-09-08T00:36:52-0700><meta property="article:modified_time" content=2014-09-08T00:36:52-0700><meta property="article:section" content="node.js"><meta property="article:author" content="https://www.davidbcalhoun.com"><meta property="article:tag" content="node.js"><meta property="article:tag" content="node"><meta property="article:tag" content="javascript"><meta property="article:tag" content="async"><meta property="article:tag" content="webdev"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="async.parallel with a simple timeout (node.js)"><meta name=twitter:url content="https://www.davidbcalhoun.com/2014/async.parallel-with-a-simple-timeout-node.js/"><meta name=twitter:site content="@franksvalli"><meta name=twitter:creator content="@franksvalli"><meta name=twitter:domain content="davidbcalhoun.com"><link rel="Shortcut Icon" type=image/ico href=https://www.davidbcalhoun.com/favicon.ico></head><body><nav class=navbar><div class=navbar-header><a class=navbar-brand href=https://www.davidbcalhoun.com/>David Calhoun's blog</a></div><ul class=navbar-links><li class=navbar-icon><a aria-label="Send an email" title="Send an email" href=mailto:david.b.calhoun+dc@gmail.com><svg aria-label="email" role="img" width="1792" height="1792" viewBox="0 0 1792 1792"><path d="M1664 1504V736q-32 36-69 66-268 206-426 338-51 43-83 67t-86.5 48.5T897 1280h-2q-48 0-102.5-24.5T706 1207t-83-67q-158-132-426-338-37-30-69-66v768q0 13 9.5 22.5t22.5 9.5h1472q13 0 22.5-9.5t9.5-22.5zm0-1051v-24.5l-.5-13-3-12.5-5.5-9-9-7.5-14-2.5H160q-13 0-22.5 9.5T128 416q0 168 147 284 193 152 401 317 6 5 35 29.5t46 37.5 44.5 31.5T852 1143t43 9h2q20 0 43-9t50.5-27.5 44.5-31.5 46-37.5 35-29.5q208-165 401-317 54-43 100.5-115.5T1664 453zm128-37v1088q0 66-47 113t-113 47H160q-66 0-113-47T0 1504V416q0-66 47-113t113-47h1472q66 0 113 47t47 113z"/></svg></i></a></li><li class=navbar-icon><a aria-label="Home Page" title="Home Page" href=https://www.themaingate.net/><svg aria-label="home site" role="img" viewBox="0 0 576 512"><path d="M280.37 148.26 96 300.11V464a16 16 0 0016 16l112.06-.29a16 16 0 0015.92-16V368a16 16 0 0116-16h64a16 16 0 0116 16v95.64a16 16 0 0016 16.05L464 480a16 16 0 0016-16V3e2L295.67 148.26a12.19 12.19.0 00-15.3.0zM571.6 251.47 488 182.56V44.05a12 12 0 00-12-12h-56a12 12 0 00-12 12v72.61L318.47 43a48 48 0 00-61 0L4.34 251.47a12 12 0 00-1.6 16.9l25.5 31A12 12 0 0045.15 301l235.22-193.74a12.19 12.19.0 0115.3.0L530.9 301a12 12 0 0016.9-1.6l25.5-31a12 12 0 00-1.7-16.93z"/></svg></i></a></li><li class=navbar-icon><a aria-label=Twitter title=Twitter href=https://twitter.com/franksvalli/><svg aria-label="twitter" role="img" width="1792" height="1792" viewBox="0 0 1792 1792"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5T1369.5 1125 1185 1335.5t-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5T285 1033q33 5 61 5 43 0 85-11-112-23-185.5-111.5T172 710v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5T884 653q-8-38-8-74 0-134 94.5-228.5T1199 256q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></i></a></li><li class=navbar-icon><a aria-label=Github title=Github href=https://github.com/davidcalhoun/><svg aria-label="github" role="img" width="1792" height="1792" viewBox="0 0 1792 1792"><path d="M896 128q209 0 385.5 103T1561 510.5 1664 896q0 251-146.5 451.5T1139 1625q-27 5-40-7t-13-30q0-3 .5-76.5t.5-134.5q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105T1386 856q0-119-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27T578 459.5 493 446q-45 113-8 204-79 87-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-39 36-49 103-21 10-45 15t-57 5-65.5-21.5T484 1274q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 88.5t.5 54.5q0 18-13 30t-40 7q-232-77-378.5-277.5T128 896q0-209 103-385.5T510.5 231 896 128zM419 1231q3-7-7-12-10-3-13 2-3 7 7 12 9 6 13-2zm31 34q7-5-2-16-10-9-16-3-7 5 2 16 10 10 16 3zm30 45q9-7 0-19-8-13-17-6-9 5 0 18t17 7zm42 42q8-8-4-19-12-12-20-3-9 8 4 19 12 12 20 3zm57 25q3-11-13-16-15-4-19 7t13 15q15 6 19-6zm63 5q0-13-17-11-16 0-16 11 0 13 17 11 16 0 16-11zm58-10q-2-11-18-9-16 3-14 15t18 8 14-14z"/></svg></i></a></li><li class=navbar-icon><a aria-label=LinkedIn title=LinkedIn href=https://www.linkedin.com/in/davidcalhoun/><svg aria-label="linkedin" role="img" width="1792" height="1792" viewBox="0 0 1792 1792"><path d="M477 625v991H147V625h330zm21-306q1 73-50.5 122T312 490h-2q-82 0-132-49t-50-122q0-74 51.5-122.5T314 148t133 48.5T498 319zm1166 729v568h-329v-530q0-105-40.5-164.5T1168 862q-63 0-105.5 34.5T999 982q-11 30-11 81v553H659q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5T1285 602q171 0 275 113.5t104 332.5z"/></svg></i></a></li></ul></nav><main role=main itemscope itemtype=https://schema.org/BlogPosting><meta itemprop=mainEntityOfPage content="https://www.davidbcalhoun.com/2014/async.parallel-with-a-simple-timeout-node.js/"><meta itemprop=inLanguage content="en-US"><span itemscope itemprop=author itemtype=https://schema.org/Person><meta itemprop=name content="David Calhoun"><meta itemprop=url content="https://www.themaingate.net"></span><span itemscope itemprop=publisher itemtype=https://schema.org/Organization><meta itemprop=name content="David Calhoun"><meta itemprop=url content="https://www.themaingate.net"><span itemprop=logo itemscope itemtype=https://schema.org/ImageObject><meta itemprop=url content="https://www.themaingate.net/david-calhoun-logo.png"><meta itemprop=width content="459"><meta itemprop=height content="459"></span></span><meta itemprop=image content="https://www.themaingate.net/david-calhoun-logo.png"><meta itemprop=datePublished content=2014-09-08T00:36:52-0700/><meta itemprop=dateModified content=2014-09-08T00:36:52-0700/><article class=item><h1 itemprop=headline class="meta title"><a href=https://www.davidbcalhoun.com/2014/async.parallel-with-a-simple-timeout-node.js/ itemprop=url>async.parallel with a simple timeout (node.js)</a></h1><time class="meta date" datetime="2014-09-08 00:36:52 -0700 -0700">September 8, 2014</time><aside class="meta tags"><span>Tags: </span><a href=https://www.davidbcalhoun.com/tags/node.js><span class=item-tag>node.js</span></a>
<a href=https://www.davidbcalhoun.com/tags/node><span class=item-tag>node</span></a>
<a href=https://www.davidbcalhoun.com/tags/javascript><span class=item-tag>javascript</span></a>
<a href=https://www.davidbcalhoun.com/tags/async><span class=item-tag>async</span></a>
<a href=https://www.davidbcalhoun.com/tags/webdev><span class=item-tag>webdev</span></a></aside></article><div class=text-justify><h2 id=-warning-this-is-an-old-article-and-may-include-information-thats-out-of-date->⚠️ Warning: this is an old article and may include information that&rsquo;s out of date. ⚠️</h2><p>A while back I had a need for a general timeout option for async.parallel and was surprised I couldn&rsquo;t find much information about how to do it. I was using async.parallel to make a lot of REST calls in parallel, but one of them was getting blocked by a firewall, resulting in an eventual timeout minutes later.</p><p>One option was to specify a shorter timeout for each individual REST call, including the one causing the problem. But I wanted a simpler solution: a general timeout for that specific async.parallel instance that made it clear all tasks should finish within a certain period of time. Otherwise return a timeout as an error, allowing the program to continue (and retry if necessary).</p><p>It was somewhat surprising there wasn&rsquo;t an option built into async.parallel, as I could imagine other folks must have had the same problem at some point in time.</p><p>In any case, I wrote a pretty simple wrapper function that gets the job done (see example usage below):</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#66d9ef>async</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;async&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// async.parallel with optional timeout (options.timeoutMS)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>parallel</span>(<span style=color:#a6e22e>options</span>, <span style=color:#a6e22e>tasks</span>, <span style=color:#a6e22e>cb</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>//  sanity checks
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>options</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>options</span> <span style=color:#f92672>||</span> {};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// no timeout wrapper; passthrough to async.parallel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span>(<span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>timeoutMS</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;number&#39;</span>) <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>async</span>.<span style=color:#a6e22e>parallel</span>(<span style=color:#a6e22e>tasks</span>, <span style=color:#a6e22e>cb</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>timeout</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>setTimeout</span>(<span style=color:#66d9ef>function</span>(){
</span></span><span style=display:flex><span>        <span style=color:#75715e>// remove timeout, so we&#39;ll know we already erred out
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>timeout</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// error out
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>cb</span>(<span style=color:#e6db74>&#39;async.parallel timed out out after &#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>timeoutMS</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;ms.&#39;</span>, <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>    }, <span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>timeoutMS</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span>.<span style=color:#a6e22e>parallel</span>(<span style=color:#a6e22e>tasks</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>result</span>){
</span></span><span style=display:flex><span>        <span style=color:#75715e>// after all tasks are complete
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// noop if timeout was called and annulled
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>timeout</span>) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// cancel timeout (if timeout was set longer, and all parallel tasks finished sooner)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>clearTimeout</span>(<span style=color:#a6e22e>timeout</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// passthrough the data to the cb
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>cb</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>result</span>);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// example usage
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>parallel</span>({<span style=color:#a6e22e>timeoutMS</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10000</span>}, [  <span style=color:#75715e>// 10 second timeout
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>function</span>(){ ... },
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span>(){ ... }
</span></span><span style=display:flex><span>],
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>results</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>err</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// timeouts can now be handled here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// an example forcing a timeout to occur
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>parallel</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>timeoutMS</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1000</span>   <span style=color:#75715e>// 1 second timeout
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>},
</span></span><span style=display:flex><span>[
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>done</span>){
</span></span><span style=display:flex><span>        <span style=color:#75715e>// task 1 completes in 100ms
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>setTimeout</span>(<span style=color:#66d9ef>function</span>(){
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>done</span>(<span style=color:#66d9ef>null</span>, <span style=color:#e6db74>&#39;foo&#39;</span>);
</span></span><span style=display:flex><span>        }, <span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>done</span>){
</span></span><span style=display:flex><span>        <span style=color:#75715e>// task 2 completes in 2000ms, forcing a timeout error
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>setTimeout</span>(<span style=color:#66d9ef>function</span>(){
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>done</span>(<span style=color:#66d9ef>null</span>, <span style=color:#e6db74>&#39;bar&#39;</span>);
</span></span><span style=display:flex><span>        }, <span style=color:#ae81ff>2000</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>],
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>results</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// err = &#39;async.parallel timed out out after 1000ms.&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>});
</span></span></code></pre></td></tr></table></div></div></div></main><section class=comments><h2 class=page-header>Comments</h2><section id=commento></section><script src=/commento.js></script></section><footer role=contentinfo><p class="copyright text-muted">©<span itemscope itemtype=https://schema.org/Person><meta itemprop=name content="David Calhoun"><a href=https://www.themaingate.net/>David Calhoun</a></span> - <a href=https://www.davidbcalhoun.com/privacy/>Privacy</a> - <a href=https://www.davidbcalhoun.com/terms-of-service/>Terms</a></p></footer></body></html>